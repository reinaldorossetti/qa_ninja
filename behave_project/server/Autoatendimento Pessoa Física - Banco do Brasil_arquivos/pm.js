var PMWindow = window.top; if (PMWindow != window) { try { if (!PMWindow.document){ PMWindow = window; }else{ if (!PMWindow._appKey){ window._pmtest = PMWindow.document; PMWindow._appKey = window._appKey; PMWindow.PM = window.PM; delete PMWindow._pmtest; delete window._appKey; delete window.PM;}}} catch (e) { PMWindow = window; }}
!function(window,document,PM,undefined){window.PM=window.PM||{},window.PM.Utils=window.PM.Utils||{},window.PM.Utils.date=function(){function _isDate(date){return"object"==typeof date&&"function"==typeof date.getDate&&"function"==typeof date.getTime}var _fromISO=function(s){var day,tz,rx=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/,p=rx.exec(s)||[];if(p[1]){day=p[1].split(/\D/);for(var i=0,L=day.length;L>i;i++)day[i]=parseInt(day[i],10)||0;return day[1]-=1,day=new Date(Date.UTC.apply(Date,day)),day.getDate()?(p[5]&&(tz=60*parseInt(p[5],10),p[6]&&(tz+=parseInt(p[6],10)),"+"==p[4]&&(tz*=-1),tz&&day.setUTCMinutes(day.getUTCMinutes()+tz)),day):NaN}return NaN},_addYear=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setYear(date.getFullYear()+value),date},_addMonth=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setMonth(date.getMonth()+value),date},_addDays=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return this._addHours(date,24*value),date},_addHours=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setHours(date.getHours()+value),date},_addMinutes=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setMinutes(date.getMinutes()+value),date},_addSeconds=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setSeconds(date.getSeconds()+value),date},_addMilliseconds=function(date,value){if(!_isDate(date))throw"Invalid Date Object";return date.setMilliseconds(date.getMilliseconds()+value),date};return{fromISO:_fromISO,addYear:_addYear,addMonth:_addMonth,addDays:_addDays,addHours:_addHours,addMinutes:_addMinutes,addSeconds:_addSeconds,addMilliseconds:_addMilliseconds}}(),window.PM=window.PM||{},window.PM.Utils=window.PM.Utils||{},window.PM.Utils.string=function(){function _isString(string){return"string"==typeof string&&"function"==typeof string.match&&"function"==typeof string.replace}var _grepWild=function(string,wildCard){if(!_isString(string))throw"Invalid String Object";for(var pattern="^",i=0;i<wildCard.length;i++){var c=wildCard.charAt(i);switch(c){case"?":pattern+=".";break;case"*":pattern+=".*";break;default:pattern+=c}}return pattern+="$",null!=string.match(pattern)},_trim=function(string){if(!_isString(string))throw"Invalid String Object";return string.replace(/^\s+|\s+$/g,"")},_lTrim=function(string){if(!_isString(string))throw"Invalid String Object";return string.replace(/^\s+/,"")},_rTrim=function(string){if(!_isString(string))throw"Invalid String Object";return string.replace(/\s+$/,"")};return{grepWild:_grepWild,trim:_trim,lTrim:_lTrim,rTrim:_rTrim}}(),window.PM=window.PM||{},window.PM.Utils=window.PM.Utils||{},window.PM.Utils.resources=function(){return{loadScript:function(src,callback,condition,removeAtEnd){if(!condition||condition&&condition()){var s=document.createElement("script");s.type="text/javascript",s.src=src,s.async=!0,s.loaded=!1,s.charset="UTF-8",s.onload=s.onreadystatechange=function(e){s.loaded||s.readyState&&!/loaded|complete/.test(s.readyState)||(s.loaded=!0,callback&&callback(),removeAtEnd&&document.getElementsByTagName("head")[0].removeChild(s))},document.getElementsByTagName("head")[0].appendChild(s)}else callback&&callback()},loadCss:function(src){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css",l.href=src,document.getElementsByTagName("head")[0].appendChild(l)}}}(),window.PM=window.PM||{},window.PM.Utils=window.PM.Utils||{},window.PM.Utils.dom=window.PM.Utils.dom||function(){var _eldestPMWindow=null,_getEldestPMWindow=function(current_window,callback){var _readyCallback=function(ready_window){try{return ready_window._appKey?ready_window:undefined}catch(e){return undefined}},_getPMWindow=function(pwindow,cb_pm){pwindow!=window.top?_getPMWindow(pwindow.parent,function(result){if(result===undefined)try{"loaded"==pwindow.document.readyState||"complete"==pwindow.document.readyState||"interactive"==pwindow.document.readyState?cb_pm(_readyCallback(pwindow)):window.PM.Events.bind(pwindow,{load:function(){cb_pm(_readyCallback(pwindow))}})}catch(e){cb_pm(undefined)}else cb_pm(result)}):cb_pm(_readyCallback(pwindow))};_eldestPMWindow?callback(_eldestPMWindow):_getPMWindow(current_window,function(result){_eldestPMWindow=result,callback(result)})};return{getEldestPMWindow:_getEldestPMWindow,isCrossOrigin:function(){try{return window.document.domain!==window.top.document.domain}catch(e){return!0}}}}(),window.PM.Storage=window.PM.Storage||function(){function _isXRTML(xRTML){return"object"==typeof xRTML&&"string"==typeof xRTML.version&&"boolean"==typeof xRTML.isReady}function _testLocalStorage(){if(_testCookies())return!1;try{var result="localStorage"in window&&null!==window.localStorage;return window.localStorage.setItem("PMS___testls","test"),window.localStorage.removeItem("PMS___testls"),result}catch(e){return!1}}function _testCookies(){if(navigator.cookieEnabled)return!0;document.cookie="cookietest=1";var ret=-1!=document.cookie.indexOf("cookietest=");return document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",ret}function _moveCookiesToLStorage(){var cookies=new Object;if(document.cookie.length>0){for(var pairs=document.cookie.split(";"),i=0;i<pairs.length;i++){var pair=pairs[i].split("="),name=pair[0].split("___");-1!==pair[0].indexOf(COOKIE_PREFIX)&&name instanceof Array&&(cookies[name[1]]||(cookies[name[1]]=new Array),cookies[name[1]][parseInt(name[2])]=pair[1])}for(var key in cookies){for(var storageValue="",i=0;i<cookies[key].length;i++)storageValue+=cookies[key][i];_deleteCookie(key),window.localStorage.setItem(LSTORAGE_PREFIX+key,storageValue)}}}function _deleteCookie(key){for(var date=new Date(0).toGMTString(),i=0;5>i&&-1!==document.cookie.indexOf(COOKIE_PREFIX+key+"___"+i);i++)document.cookie=COOKIE_PREFIX+key+"___"+i+"=;expires="+date}function _deleteEntry(key,value){_supports_lstorage?window.localStorage.removeItem(LSTORAGE_PREFIX+key):_deleteCookie(key),delete _storage[key]}function _init(xRTML){if(!xRTML||!_isXRTML(xRTML))throw"PM.Storage must be initialized with xRTML framework";if(_xRTML=xRTML,_storage=new Object,_ready=!0,_supports_lstorage=_testLocalStorage()){_moveCookiesToLStorage();for(var i=0;i<window.localStorage.length;i++){var fname=window.localStorage.key(i),name=fname.split("___");-1!==fname.indexOf(LSTORAGE_PREFIX)&&name instanceof Array&&(_storage[name[1]]||(_storage[name[1]]=new Array),_storage[name[1]][0]=window.localStorage.getItem(fname))}}else if(document.cookie.length>0)for(var pairs=document.cookie.split(";"),i=0;i<pairs.length;i++){var pair=pairs[i].split("="),name=pair[0].split("___");-1!==pair[0].indexOf(COOKIE_PREFIX)&&name instanceof Array&&(_storage[name[1]]||(_storage[name[1]]=new Array),_storage[name[1]][parseInt(name[2])]=pair[1])}for(var name in _storage){for(var storageValue="",i=0;i<_storage[name].length;i++)storageValue+=_storage[name][i];storageValue.length>0?(_storage[name]=_xRTML.JSON.parse(unescape(storageValue)),_storage[name]=new Entry(_storage[name].name,_storage[name].value,_storage[name].expires,_storage[name].path,_storage[name].domain,_storage[name].secure)):delete _storage.name}}var COOKIE_PREFIX="CS___",LSTORAGE_PREFIX="PMS___",_storage=null,_xRTML=null,_ready=!1,_supports_lstorage=!1,save=function(){var cookieString="";this.expires&&(cookieString+="; expires="+this.expires.toGMTString()),cookieString+=this.path?"; path="+escape(this.path):"; path=/",this.domain&&(cookieString+="; domain="+escape(this.domain)),this.secure&&(cookieString+="; secure");var value=escape(_xRTML.JSON.stringify(this));if(_supports_lstorage)window.localStorage.setItem(LSTORAGE_PREFIX+this.name,value);else{var idx=0,cookiePart=0;do{var maxCookieValueLength=4096-this.name.length-cookieString.length-cookiePart.toString().length-10,parcialValue=value.substring(idx,idx+maxCookieValueLength);document.cookie=COOKIE_PREFIX+this.name+"___"+cookiePart+"="+parcialValue+cookieString,idx+=maxCookieValueLength,cookiePart+=1}while(idx<value.length)}},Entry=function(name,value,expires,path,domain,secure){this.name=name,this.value=undefined;try{this.value="object"==typeof value?value:_xRTML.JSON.parse(value)}catch(e){this.value=value}try{expires?expires instanceof Date?this.expires=expires:(this.expires=new Date(expires),(!this.expires||isNaN(this.expires))&&(this.expires=window.PM.Utils.date.fromISO(expires))):this.expires=undefined}catch(e){throw"The parameter expires isn't a instance of Date or a valid string"}if(this.path=path,this.domain=domain,!domain){var topDomain=/[^.]*\.[^.]{2,3}(?:\.[^.]{2,3})?$/.exec(document.domain);topDomain&&1==topDomain.length&&(this.domain=topDomain[0])}this.secure=secure,save.call(this)};return{init:function(xRTML){_ready||_init(xRTML)},getAll:function(){var ret=new Object;for(var field in _storage){var c=_storage[field];c.expires==undefined||c.expires>new Date?ret[field]=c:this.remove(c.name)}return ret},get:function(name){var c=_storage[name];if(c){if(c.expires==undefined||c.expires>new Date)return c;this.remove(c.name)}return undefined},add:function(name,value,expires,path,domain,secure){if(_storage[name]==undefined||_storage[name]!=undefined&&(_storage[name].expires==undefined||_storage[name].expires<new Date))return _storage[name]=new Entry(name,value,expires,path,domain,secure),_storage[name];throw"There is already an entry with name '"+name+"' in the storage"},update:function(name,value,expires,path,domain,secure){var c=this.get(name);if(c)return this.remove(c.name),this.add(name,value,expires,path,domain,secure);throw"There is no entry with name '"+name+"' in the storage"},refresh:function(){_init(_xRTML)},remove:function(key){var value=_storage[key];value&&_deleteEntry(key,value)},isMediumAvailable:function(){return _testLocalStorage()||_testCookies()}}}(),window.PM=window.PM||{},window.PM.ConnectionManager=window.PM.ConnectionManager||new function(){var self=this;this.connection=null,this.send=function(channels,message){message="string"==typeof message?window.PM.xRTML.JSON.parse(message):message,message.cid=window.PM.SessionData.account.contextId,message.wsid=window.PM.SessionData.account.siteId,message.sid=window.PM.SessionData.account.sessionId;for(var i=0;i<=channels.length-1;i++)window.PM.xRTML.ConnectionManager.sendMessage({connections:[self.connection.id],channel:channels[i],content:window.PM.xRTML.JSON.stringify(message)})},this.initialize=function(){if(self.connection){self.connection.id=window.PM.SessionData.account.sessionId,self.connection.appKey=window.PM.SessionData.account.appKey,self.connection.authToken=window.PM.SessionData.account.authToken,self.connection.url=window.PM.SessionData.account.ortcServer.url,self.connection.isCluster=window.PM.SessionData.account.ortcServer.isCluster,self.connection.setHeartbeatActive(!0),self.connection.setHeartbeatFails(window.PM.SessionData.account.ortcServer.heartBeatFails),self.connection.setHeartbeatTime(window.PM.SessionData.account.ortcServer.heartBeatTime),self.connection.setMetadata({type:1,sid:window.PM.SessionData.account.sessionId,cid:window.PM.SessionData.account.contextId});for(var ch in self.connection.channels)self.connection.isSubscribed(ch)&&self.connection.unsubscribe(ch);self.connection.channels={},self.connection.createChannel({name:window.PM.SessionData.account.channels.public_fromServer}),self.connection.createChannel({name:window.PM.SessionData.account.channels.private_fromServer}),self.connection.connect()}else{var pmEvents=window.PM.Events;self.connection=window.PM.xRTML.ConnectionManager.create({id:window.PM.SessionData.account.sessionId,appKey:window.PM.SessionData.account.appKey,authToken:window.PM.SessionData.account.authToken,url:window.PM.SessionData.account.ortcServer.url,isCluster:window.PM.SessionData.account.ortcServer.isCluster,heartBeatActive:!0,heartBeatFails:window.PM.SessionData.account.ortcServer.heartBeatFails,heartBeatTime:window.PM.SessionData.account.ortcServer.heartBeatTime,metadata:{type:1,sid:window.PM.SessionData.account.sessionId,cid:window.PM.SessionData.account.contextId},channels:[{name:window.PM.SessionData.account.channels.public_fromServer},{name:window.PM.SessionData.account.channels.private_fromServer}]}),self.connection.bind({create:function(e){pmEvents.fire({onOrtcCreated:{data:e}})},connect:function(e){pmEvents.fire({onOrtcConnected:{data:e}})},disconnect:function(e){pmEvents.fire({onOrtcDisconnected:{data:e}})},subscribe:function(e){pmEvents.fire({onOrtcChannelSubscribed:{data:e}})},unsubscribe:function(e){pmEvents.fire({onOrtcChannelUnsubscribed:{data:e}})},exception:function(e){pmEvents.fire({onOrtcException:{data:e}})},reconnect:function(e){pmEvents.fire({onOrtcReconnected:{data:e}})},reconnecting:function(e){pmEvents.fire({onOrtcReconnecting:{data:e}})},message:function(e){var message=window.PM.xRTML.JSON.parse(e.message);if("sessionDataResponse"==message.action||"sessionDataResponse"==message.a)pmEvents.fire({onSessionMessageReceived:{data:message}});else{var data={a:message.a,d:message.d,v:message.v,sid:message.sid,uid:message.uid,cid:message.cid};"visitorDispose"==message.action||"visitorDispose"==message.a?pmEvents.fire({onVisitorDispose:{}}):pmEvents.fire({onMessageReceived:{data:data}})}}})}},this.dispose=function(){self.connection.unbindAll(),self.connection.dispose(),self.connection=null}},window.PM.Session=window.PM.Session||{UABlackList:{exact:[],wildcard:["*bot*","*crawl*","*spider*","*192.comAgent*","*UnCHAOS*","*Sygol*","*Aladin*","*amzn_assoc*","*Apexoo Spider*","*archive.org_bot*","*Aport*","*ASPSeek*","*Baiduspider*","*Combine/*","*searchpsider.com*","*http://help.yahoo.co.jp/help/jp/search/indexing*","*somewhere.com*","*Ask Jeeves*","*EZResult*","*genieknows*","*Harvest*","*KnowItAll*","*MicroBaz*","*MSNPTC*","*Linkcheckerradian6.com*","*radian6.com*","*Reaper*","*Robozilla*","*Scooter*","*scoutmaster*","*Scrubby*","*search.ch*","*SearchByUsa*","*Seeker*","*Spinne*","*Syndirella*","*Tagword*","*teomaagent*","*Toutatis*","*Twiceler*","*SKIZZLE*","*Vagabondo*","*voyager*","*wavefire*","*Web Snooper*","*Websquash*","*Yahoo Pipes*","*Yahoo! Mindset*","*pulsoprobe-i-001*","*pulsoprobe-i-002*","*pulsoprobe-i-003*","*pulsoprobe-i-004*","*pulsoprobe-i-005*","*pulsoprobe-i-100*","*pulsoprobe-i-101*"],regex:[]},isUserAgentBlackListed:function(userAgent){if(!userAgent)return!1;for(var i=0;i<window.PM.Session.UABlackList.exact.length;i++)if(window.PM.Session.UABlackList.exact[i]==userAgent)return!0;for(var i=0;i<window.PM.Session.UABlackList.wildcard.length;i++)if(window.PM.Utils.string.grepWild(userAgent,window.PM.Session.UABlackList.wildcard[i]))return!0;for(var i=0;i<window.PM.Session.UABlackList.regex.length;i++)if(userAgent.match(window.PM.Session.UABlackList.regex[i]))return!0;return!1},retryCodes:{3040:!0,3001:!0},_complete:null,init:function(callback){window.PM.Session._complete=callback,window.PM.SessionData=window.PM.SessionData||{},window.PM.SessionData.account=window.PM.SessionData.account||{};var sid=window.PM.Storage.get("SessionId")&&window.PM.Storage.get("SessionId").value?window.PM.Storage.get("SessionId").value:null;if(!sid&&PM.Utils.dom.isCrossOrigin())setTimeout(function(){PM.Session.getSession(PM.SessionData.sessionServiceUrl,undefined,"window.PM.Session.newVisitorRequestCallback")},2500);else if(sid){window.PM.SessionData.account.sessionId=sid;var sessionSettings=PM.Storage.get("SessionSettings")&&PM.Storage.get("SessionSettings").value?PM.Storage.get("SessionSettings").value:null;sessionSettings&&sessionSettings[window._appKey]?window.PM.Session.start(sessionSettings[window._appKey],!1):PM.Session.validateSessionId(sid,"window.PM.Session.oldVisitorRequestCallback")}else PM.Session.getSession(PM.SessionData.sessionServiceUrl,undefined,"window.PM.Session.newVisitorRequestCallback")},start:function(sessionData,isNewVisitor){window.PM.SessionData.account={siteId:sessionData.siteid,ip:sessionData.ip,sessionId:sessionData.sid,contextId:!isNewVisitor&&window.PM.SessionData.account&&window.PM.SessionData.account.contextId?window.PM.SessionData.account.contextId:Math.floor(Math.random()*(Math.pow(2,53)-1+1))+1,appKey:window._appKey,authToken:sessionData.ortc.token||"PM.Anonymous",channels:{public_fromClient:"fromclient",private_fromClient:"fromclient:"+sessionData.sid,public_fromServer:"fromserver",private_fromServer:"fromserver:"+sessionData.sid,interactions:"ibt.fromserver.interactions",visitor_ping:"vp"},ortcServer:{heartBeatFails:sessionData.ortc&&sessionData.ortc.fails||3,heartBeatTime:sessionData.ortc&&sessionData.ortc.time||10,url:"http:"===document.location.protocol?sessionData.ortc.url:sessionData.ortc.secureUrl,isCluster:"boolean"==typeof sessionData.ortc.cluster?sessionData.ortc.cluster:!1},modules:[]},isNewVisitor&&window.PM.Storage.get("CF")&&window.PM.Storage.get("CF").value&&(window.PM.SessionData.customFieldsHistory=window.PM.Storage.get("CF").value);var sd_get_timer,sd_get_retries=0,SD_GET_TIMEOUT=3e4,SD_GET_MAXRETRIES=1,self=window.PM.Session,_processSegments=function(msg){"vsegments"==msg.data.a&&(window.PM.SessionData.segments=msg.data.d.list)},getSessionData=function(){window.PM.Events.bind({onMessageReceived:_processSegments});var requestSessionDataMessage={a:"sessionData",d:{ip:window.PM.SessionData.account.ip,ua:window.navigator.userAgent,referrer:document.referrer?encodeURIComponent(document.referrer):undefined,pageUrl:window.location.href,pageTitle:document.title}};window.PM.ConnectionManager.send([window.PM.SessionData.account.channels.public_fromClient],requestSessionDataMessage),sd_get_timer=setTimeout(function(){++sd_get_retries<=SD_GET_MAXRETRIES?getSessionData():window.PM.ConnectionManager.connection.dispose()},SD_GET_TIMEOUT)},onSessionMessageReceived=function(e){var message=e.data;"sessionDataResponse"===message.a&&message.d.contextId===window.PM.SessionData.account.contextId&&(clearTimeout(sd_get_timer),window.PM.Session.processSessionData(message.d),window.PM.Events.unbind({onOrtcConnected:getSessionData,onSessionMessageReceived:onSessionMessageReceived,onOrtcException:onException}),self._complete())},onException=function(e){if(!PM.ConnectionManager.connection.isConnected())if(isNewVisitor)window.PM.Events.unbind({onOrtcConnected:getSessionData,onSessionMessageReceived:onSessionMessageReceived,onOrtcException:onException});else if(window.PM.Session.oldVisitorRequestRetries>0){window.PM.SessionData.sessionServiceUrl+"/"+window.PM.SessionData.account.sessionId;PM.Session.validateSessionId(window.PM.SessionData.account.sessionId,"window.PM.Session.oldVisitorRequestCallback")}else window.PM.Events.unbind({onOrtcConnected:getSessionData,onSessionMessageReceived:onSessionMessageReceived,onOrtcException:onException})},onVisitorDispose=function(m){window.PM.SessionData.account.modules.length>0?setTimeout(onVisitorDispose,500):(window.PM.ConnectionManager.dispose(),window.PM.Session.newVisitorRequestRetries=2,window.PM.Session.getSession(PM.SessionData.sessionServiceUrl,undefined,"window.PM.Session.newVisitorRequestCallback"))};window.PM.Events.bind({onOrtcConnected:getSessionData,onSessionMessageReceived:onSessionMessageReceived,onOrtcException:onException}),window.PM.Events.once({onVisitorDispose:onVisitorDispose}),window.PM.xRTML.ready(function(){window.PM.SessionData.account&&window.PM.SessionData.account.sessionId&&window.PM.ConnectionManager.initialize()})},validateSessionId:function(sessionid,callback){window.PM.Session.isUserAgentBlackListed(navigator.userAgent)||window.PM.Utils.resources.loadScript(window.PM.SessionData.sessionServiceUrl+"/"+sessionid+"/"+callback,undefined,null,!0)},oldVisitorRequestRetries:1,oldVisitorRequestCallback:function(sessionData,httpStatusCode){if(window.PM.Session.oldVisitorRequestRetries-=1,window.PM.Session.retryCodes[sessionData]&&window.PM.Session.oldVisitorRequestRetries>=0)setTimeout(function(){PM.Session.validateSessionId(window.PM.SessionData.account.sessionId,"window.PM.Session.oldVisitorRequestCallback")},500+parseInt(500*Math.random()));else{var sessionSettings=PM.Storage.get("SessionSettings")&&PM.Storage.get("SessionSettings").value?PM.Storage.get("SessionSettings").value:{};sessionSettings[window._appKey]=sessionData,PM.Storage.remove("SessionSettings"),sessionData.expire&&"number"==typeof sessionData.expire?window.PM.Storage.add("SessionSettings",sessionSettings,sessionData.expire):window.PM.Storage.add("SessionSettings",sessionSettings,window.PM.Utils.date.addHours(new Date,1)),PM.Storage.remove("SessionId"),window.PM.Storage.add("SessionId",sessionData.sid,window.PM.Utils.date.addYear(new Date,1)),window.PM.Session.start(sessionData,!1)}},getSession:function(serviceUri,callback,requestSessionCallback){window.PM.Session.isUserAgentBlackListed(navigator.userAgent)||window.PM.Utils.resources.loadScript(serviceUri+"/"+requestSessionCallback,callback,null,!0)},newVisitorRequestRetries:2,newVisitorRequestCallback:function(sessionData,httpStatusCode){if(window.PM.Session.newVisitorRequestRetries-=1,window.PM.Session.retryCodes[sessionData]&&window.PM.Session.newVisitorRequestRetries>=0)setTimeout(function(){window.PM.Session.getSession(window.PM.SessionData.sessionServiceUrl,undefined,"window.PM.Session.newVisitorRequestCallback")},500+parseInt(500*Math.random()));else{var sessionSettings=PM.Storage.get("SessionSettings")&&PM.Storage.get("SessionSettings").value?PM.Storage.get("SessionSettings").value:{};sessionSettings[window._appKey]=sessionData,PM.Storage.remove("SessionSettings"),sessionData.expire&&"number"==typeof sessionData.expire?window.PM.Storage.add("SessionSettings",sessionSettings,sessionData.expire):window.PM.Storage.add("SessionSettings",sessionSettings,window.PM.Utils.date.addHours(new Date,1)),PM.Storage.remove("SessionId"),window.PM.Storage.add("SessionId",sessionData.sid,window.PM.Utils.date.addYear(new Date,1)),window.PM.Session.start(sessionData,!0)}},processSessionData:function(sessionData){for(var selectorsArray=sessionData.selectors,i=0;i<selectorsArray.length;++i)selectorsArray[i]=window.PM.xRTML.JSON.parse(selectorsArray[i]);window.PM.SessionData.selectors=selectorsArray||[],window.PM.SessionData.integrations=window.PM.xRTML.JSON.parse(sessionData.integrations),window.PM.SessionData.PMEvents=sessionData.events||{},window.PM.SessionData.socialAppKey=sessionData.socialAppKey,window.PM.SessionData.externalFiles=window.PM.xRTML.JSON.parse(sessionData.externalFiles||"{}"),window.PM.SessionData.textChatBackoffice=!!(2&sessionData.interactionStatus),window.PM.SessionData.videoChatBackoffice=!!(4&sessionData.interactionStatus),window.PM.SessionData.callMeNowBackoffice=!!(8&sessionData.interactionStatus),window.PM.SessionData.VisitorWidgets={global:sessionData.visitorWidgetGlobal,page:sessionData.visitorWidgetPages},window.PM.SessionData.segments=window.PM.SessionData.segments||sessionData.segments,window.PM.SessionData.pmFile=sessionData.pmFile?sessionData.pmFile:null,window.PM.SessionData.pingTime=sessionData.pt||6e4,window.PM.SessionData.ortcDebugEnabled=sessionData.debug||!1,window.PM.SessionData.interactions={isBlocked:!!sessionData.isBlocked,textChat:{operatorNotifications:!1,messageTimeout:1e4},videoChat:{},helpRequest:window.PM.xRTML.JSON.parse(sessionData.helpRequest),inviteTimeout:"number"==typeof sessionData.inviteTimeout?sessionData.inviteTimeout:6e4,helpRequestTimeout:"number"==typeof sessionData.helpRequestTimeout?sessionData.helpRequestTimeout:3e4}}},function(PM,undefined){if(!PM.isLoaded){PM.isLoaded=!0,String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(Retargeting){if(Retargeting.active){var pmRetargeting=document.createElement("input");pmRetargeting.type="hidden",pmRetargeting.id="PM_RETARGETING",pmRetargeting.value="true",document.getElementsByTagName("body")[0].appendChild(pmRetargeting)}}(PM.Retargeting=PM.Retargeting||{});var _baseUri=window.location.protocol+"//www72.bb.com.br/",_baseServicesUri=_baseUri+"session/"+window._appKey,_baseResourcesUri=window.location.protocol+"//www73.bb.com.br/web/static/visitor/",_bootstrapperRemHandler=null,_bootstrapBind=function(){_bootstrapperRemHandler&&_bootstrapperRemHandler();var _waitReady=function(){PM.Storage.refresh();var mySession=PM.Storage.get("Session"),instance_starting=PM.Storage.get("State");return mySession||!instance_starting||"ready"==instance_starting.value?(instance_starting||PM.Storage.add("State","booting",PM.Utils.date.addSeconds(new Date,10)),clearInterval(_checkInterval),_bootstrap(),!0):!1},_checkInterval=null,xrtmlSrc=_baseResourcesUri+"scripts/xrtml-3.2.7-min.js?v3.2.7";PM.Utils.resources.loadScript(xrtmlSrc,function(){try{PM.xRTML=window.xRTMLVersions["3.2.7"],PM.xRTML.Templating.forceTemplateEngine(PM.xRTML.Templating.TemplateEngine.Native),PM.Storage.init(PM.xRTML),PM.Events=function(){var pmEventsObject=new Object;return PM.xRTML.Event.extend(pmEventsObject),pmEventsObject}(),_waitReady()||(_checkInterval=setInterval(_waitReady,200))}catch(e){console.log("xRTML is undefined")}})},_bootstrap=function(){PM.SessionData=PM.SessionData||{pushAdServicesUriTemplate:_baseServicesUri+"services/pushadservice.svc/AdContent?content=",sessionServiceUrl:_baseServicesUri,interactionsServiceUrl:_baseUri+"visitor/"+window._appKey+"/interaction/",resources:{swfobject:_baseResourcesUri+"scripts/swfobject.js"}},PM.Utils.dom.getEldestPMWindow(window,function(eldest_window){PM.SessionData.isEldestPM=window==eldest_window});var pmCss=_baseResourcesUri+"css/pm.visitor-styles.css";PM.visitorServices=PM.visitorServices||{},PM.visitorServices.sessionService=PM.SessionData.sessionServiceUrl,PM.Session.init(_bootstrapCompleted),PM.Utils.resources.loadCss(pmCss)},_bootstrapCompleted=function(){var pmSrc=_baseResourcesUri+"scripts/pm.visitor-min.js";PM.Storage.get("State")?PM.Storage.update("State","ready",PM.Utils.date.addSeconds(new Date,30)):PM.Storage.add("State","ready",PM.Utils.date.addSeconds(new Date,30)),pmSrc=PM.SessionData.pmFile||pmSrc,PM.Utils.resources.loadScript(pmSrc,function(){window.PM.Events.fire({pmReady:{}});for(var externalJs=window.PM.SessionData.externalFiles.js||[],externalCss=window.PM.SessionData.externalFiles.css||[],idx=0;idx<externalJs.length;idx++){var filePath=window.location.protocol+externalJs[idx];PM.Utils.resources.loadScript(filePath,null,null,!0)}for(var idx=0;idx<externalCss.length;idx++){var filePath=window.location.protocol+externalCss[idx];PM.Utils.resources.loadCss(filePath)}})};"complete"==document.readyState||"interactive"==document.readyState?_bootstrapBind():window.addEventListener?(window.addEventListener("load",_bootstrapBind,!1),_bootstrapperRemHandler=function(){window.removeEventListener("load",_bootstrapBind,!1)}):window.attachEvent&&(window.attachEvent("onload",_bootstrapBind),_bootstrapperRemHandler=function(){window.detachEvent("onload",_bootstrapBind)})}}(window.PM=window.PM||{})}(PMWindow,PMWindow.document,PMWindow.PM=PMWindow.PM||{});