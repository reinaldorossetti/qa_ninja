'use strict';

/* Directives */ 
/*define(['angular', 'factories', 'helpers', 'iScroll', 'select2', 'shareBar', 'barraBrasil', 'ENI'], function (angular, barraBrasil) {*/
define(['angular', 'factories', 'helpers','jQuery','jQueryMask','bootstrapCollapse', 'bootstrapTransitions', 'iScroll', 'select2', 'shareBar', 'footable','mCustomScrollbar','reTree','adaptiveDetection','fullCalendar'], function (angular, bootstrapTransitions, bootstrapCollapse, adaptiveDetection) {
	angular.module('bb.diretivas', ['ngCookies'])
    .directive('bbHeader', function($rootScope, $detection, $cookieUtil, $portalUtil, $timeout, $customizacao, $filter) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/header'+(["A0","B0","C0"].indexOf(portalParam.nicho.toUpperCase()) > -1 ? portalParam.nicho.substr(0,1).toUpperCase() : portalParam.testeira)+'.html?+nd='+Date.now(),
        replace: true,
        link: function(scope, element, attr) {
        	
        	if( ["A0","B0","C0"].indexOf(portalParam.nicho.toUpperCase()) > -1 ){
	       		 portalParam.testeira = portalParam.nicho.substr(0,1).toUpperCase();
	       	}
        	
        	
        	
        	/**
        	 * js para header fixo apenas para Desktop(definido pelo if - tamanhoTela)
        	 */

        	$(document).ready(function(){
    	    	var lastScrollTop = 80;
	    	    	$(window).on("scroll touchmove", function () {
	    	    		var tamanhoTela = (typeof window.innerWidth === "undefined") ? document.documentElement.offsetWidth : window.innerWidth;
	    	    		var currentScroll = $(document).scrollTop();
	    	    	
	    	    		if(tamanhoTela > 768) {
	    	    			
	    	    			if($('#barra-titulo').hasClass('act')) {
	    	    				
	    	    				if(currentScroll > 401) {	
	    	    					
	    	    					$('#barra-titulo').css("display", "block");	    	    						    	    					
	    	    					$('#account-access').addClass('animated slideInDown headerFixo aplicouEvento');
	    	    					$('#overlay').show();


	    	    				} else if($('#account-access').hasClass('aplicouEvento')){
	    	    					$('#account-access').removeClass('slideInDown');
	    	    				} 
	    	    				
	    	    				if( currentScroll < 380 ){
	    	    					$('#account-access').removeClass('animated slideInDown headerFixo aplicouEvento');
	    	    					$('#overlay').hide();
	    	    				}
	    	    				
	    	    			} else {
	    	    				
	    	    				if(currentScroll > 135){	    		    	    						
	    	    					$('#account-access').addClass('animated slideInDown headerFixo aplicouEvento');
	    	    					$('#overlay').show();
	    	    					
	    	    				} else if($('#account-access').hasClass('aplicouEvento')){
	    	    					$('#account-access').removeClass('slideInDown');
	    	    				} 
	    	    				
	    	    				if( currentScroll < 82 ){
	    	    					$('#account-access').removeClass('animated slideInDown headerFixo aplicouEvento');
	    	    					$('#overlay').hide();
	    	    				}
	    	    				
	    	    			}
		    	    	
	    	    		} else if($('#account-access').hasClass('aplicouEvento')) {
		    	    		$('#account-access').removeClass('animated slideInDown headerFixo aplicouEvento');
	    	    		}
	    	    	});
        	

			    	/**
		        	 * Fim js header fixo
		        	 */

        	});
   	
        	
	       	
	       	if(typeof(portalParam.menuBean[0]) != "undefined"){
	       		if(portalParam.menuBean[0].amigavel.indexOf("/imprensa/") != -1 ){
	       			
	       			$rootScope.title =  $portalUtil.getTituloSeguimentoAcentuado(portalParam.seguimento) + ' | Imprensa ';
	       			
	       			scope.$watch('noticiaAberta', function() {
	       				if(typeof scope.noticiaAberta !== 'undefined') {
	       					$rootScope.title =  'Imprensa | ' +scope.noticiaAberta.titulo;	 
	       				}
	           		});
	       			
	       		}else{
	       			
	       			var tituloPagina = $portalUtil.UTF8("decode",portalParam.menuBean[0].titulo); 
	       			
	       			if($portalUtil.getTituloSeguimentoAcentuado(portalParam.seguimento) == tituloPagina ){
	       				tituloPagina = "Página Inicial";
	       			}
	       			
	       			
	       			$rootScope.title =  $portalUtil.getTituloSeguimentoAcentuado(portalParam.seguimento) + ' | ' +tituloPagina+ ' | Banco do Brasil' ;
	       		}
	       		
	       		
	       	}else{
	       		$rootScope.title = ' Banco do Brasil - ' + portalParam.url.replace("/pbb/","");
	       	}
        	
        	if($detection.isAndroid()) {
        		scope.mobileOS = 'Android';
        	}
        	else if($detection.isiOS()) {
        		scope.mobileOS = 'iOS';
        	}
        	else if($detection.isWindowsPhone()) {
        		scope.mobileOS = 'WindowsPhone';
        	}
        	else {
        		scope.mobileOS = 'undefined';
        	}
        		
        	/**
        	 * atribuir variavel ao elemento "a" da lista pessoa fisica -> continua na funcao "swithMenuPilar"
        	 */
        	if(portalParam.seguimento == "1"){        		     
        		scope.classBorderSeg = "borderMenuPilar";            		     
        	} 
        	if(portalParam.seguimento == "6"){        		      
        		scope.classBorderSeg = "borderMenuPilar";   
        	}     
        	if(portalParam.seguimento == "7"){        		    
        		scope.classBorderSeg = "borderMenuPilar";   
        	}             	
        	
        	if(portalParam.idioma == "2"){
        		$rootScope.urlBusca = $portalUtil.getURLBusca("101");		
        	}else{
        		$rootScope.urlBusca = $portalUtil.getURLBusca(portalParam.seguimento);
        	}
        	
        	
        	
        	scope.classIsCallToAction = "";
        	
        	if(portalParam.testeira == "C"){
        		$rootScope.escondeBotaoMeuAcessoEBusca=false;
    			if(portalParam.meuAcesso == "20"){
    				$rootScope.escondeBotaoMeuAcessoEBusca = true;
    			}            	
        	}else if(portalParam.testeira == "B"){
        		

        		$rootScope.escondeBotaoMeuAcessoEBusca=false;
    			if(portalParam.meuAcesso == "20"){
    				$rootScope.escondeBotaoMeuAcessoEBusca = true;
    			}
        		
        		$rootScope.exibeMenuIdioma = false;
        		$rootScope.ocultaCursorLinkAcesse = true;
        		
        		
        		
        		$rootScope.swithMenuIdioma = function(lista, item){
        			if(lista.length == 1){
        				document.location.href = item.link;	
        			}else if(lista.lenght == 0){
        			}else{
        				$rootScope.exibeMenuIdioma = !$rootScope.exibeMenuIdioma;
        			}
        		};

        		$rootScope.swithMenuIdiomas = function(){
        			$rootScope.exibeMenuIdioma = !$rootScope.exibeMenuIdioma;
        		}
        		
	    		//Faz uma copia do menu para uso no menu mobile
	    		scope.$watch('header', function() {
		   	    	  if(typeof scope.header !== 'undefined') {

		   	    		scope.header.isMeuAcesso = $customizacao.is("header.meuAcesso");
		    	    	scope.header.isBuscar = $customizacao.is("header.buscar");
		    	    	
		   	    		if(scope.header.chamadaBotaoAcesso != null && scope.header.chamadaBotaoAcesso.texto != null ){
		   	    			$rootScope.ocultaCursorLinkAcesse = false;	
		   	    		}
		   	    		$timeout(function(){		   	    			 
		   	    			 $("#menuMobileDefault").html($("#menuMobileDefault_Pre").html());	   	    			
		   	    		},1000);
		   	    	  }
	    		 });

        	}else if(portalParam.testeira == "A"){
        		
	        	
	        	
	    		/**
	        	 * Menu Seguimentos
	        	 */
	    		$rootScope.escondeMenuPilar = false;
	        	$rootScope.escondeMenuHeader = false;
	        	
	        	$rootScope.swithMenuPilar = function(){
	        		
	        		$rootScope.escondeMenuPilar = !$rootScope.escondeMenuPilar;
	        		
	        		if($rootScope.escondeMenuPilar){
	        			$("#bb-types").slideDown(300);
	        			$('#barra-titulo').addClass('act');
	        		}else{
        				$("#bb-types").slideUp(300);
        				$('#barra-titulo').removeClass('act');
	        		}
	        		
	        		/**
	            	 * get by id and set class to border effect
	            	 */
	        		if(portalParam.seguimento == "1"){            		
	            		$("#borderMenuPilar3").addClass("borderMenuPilar1");      
	            	} 
	        		if(portalParam.seguimento == "6"){	            		 
	            		$("#borderMenuPilar6").addClass("borderMenuPilar6");      
	            	} 
	        		if(portalParam.seguimento == "7"){	            		
	            		$("#borderMenuPilar7").addClass("borderMenuPilar7");      
	            	} 
	    		};
	    		$rootScope.swithMenuHeader = function(){
	    			$rootScope.escondeMenuHeader = !$rootScope.escondeMenuHeader;
	    		};
	    		
	    		//$('#bb-types').on('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){  			alert("passei");    		});
	    		
				$rootScope.barraAplicativo = {};
			    $rootScope.barraAplicativo.linkInstalar = "";
			    $rootScope.barraAplicativo.exibeFaixaAzul = false;
			    
	    		/**
	        	 * Botoes acesse sua conta
	        	 */
	    		 scope.$watch('header', function() {
		   	    	  if(typeof scope.header !== 'undefined') {
		   	    		  
		   	    		scope.header.isMeuAcesso = $customizacao.is("header.meuAcesso");
		   	    		scope.header.isBuscar = $customizacao.is("header.buscar");
		   	    		
		   	    		scope.header.tituloSegmento = $portalUtil.getTituloSeguimentoAcentuado(portalParam.seguimento);
		   	    		
						/**
			        	 * Responsavel pela faixa azul para dispositivos moveis
			        	 */
			        	var ambienteMobile = false;
			        	if($detection.isAndroid() || $detection.isiOS() || $detection.isWindowsPhone()){
			        		ambienteMobile=true;
			        	}
			        		
			        	if($portalUtil.getTema(portalParam.seguimento) == "1"){
			        		$rootScope.barraAplicativo.urlBotaoFechar = "/pbb/app/docs/comum/images/icones/botaoFechar.png";
			        	}else if($portalUtil.getTema(portalParam.seguimento) == "6"){
			        		$rootScope.barraAplicativo.urlBotaoFechar = "/pbb/app/docs/comum/images/icones/botaoFechar6.png";
			        	}else if($portalUtil.getTema(portalParam.seguimento) == "7"){
			        		$rootScope.barraAplicativo.urlBotaoFechar = "/pbb/app/docs/comum/images/icones/botaoFechar7.png"; 
			        	}
			        	
			        	var enderecoLinkUtil = "";
			        	
			        	if(typeof(scope.header.barraApp) != "undefined" && scope.header.barraApp != null){
			        		
			        		enderecoLinkUtil = angular.fromJson($('<div/>').html(scope.header.barraApp.endederecoJson).text());
			        	
			        		if(typeof($cookieUtil.get('faixaInstalar')) == 'undefined'){
				        		
				        		if($detection.isAndroid()){
				        			if(typeof(enderecoLinkUtil.android) != "undefined"){
				        				$rootScope.barraAplicativo.exibeFaixaAzul = true;
						        		$rootScope.barraAplicativo.linkInstalar = enderecoLinkUtil.android;
				        			}
				        			ambienteMobile = true;
				        			
					        	}else if ($detection.isiOS()){
					        		if(typeof(enderecoLinkUtil.ios) != "undefined"){
				        				$rootScope.barraAplicativo.exibeFaixaAzul = true;
						        		$rootScope.barraAplicativo.linkInstalar = enderecoLinkUtil.ios;
				        			}
					        		ambienteMobile = true;
					        	}else if ($detection.isWindowsPhone()){
					        		
					        		if(typeof(enderecoLinkUtil.windowsPhone) != "undefined"){
					        			$rootScope.barraAplicativo.exibeFaixaAzul = true;
						        		$rootScope.barraAplicativo.linkInstalar = enderecoLinkUtil.windowsPhone;
				        			}
					        		ambienteMobile = true;
					        	}
				        	}
				        	
			        	
			        	}
			        	
			        	
			        	if($rootScope.barraAplicativo.exibeFaixaAzul){
			        		$cookieUtil.put('faixaInstalar','loja=S',7);
			        	}
			        	
			        	$rootScope.ocultarFaixaAzul = function(){
			        		$rootScope.barraAplicativo.exibeFaixaAzul = false;
			    		};
			        	
			    		
			    		scope.header.indiceFilho = 1000;
			    		scope.header.setaIndice = function(isFilho , indice){
			    			if(scope.header.indiceFilho == 1000 && isFilho){
			    				scope.header.indiceFilho = indice;	
			    			}
			    		} 
			    		  
		   	    		  
		   	    		  $timeout(function(){		   	    			 
		   	    			 $("#menuMobileDefault").html($("#menuMobileDefault_Pre").html());	   	    			
		   	    		  },1000);
		   	    		  scope.header.linkAcesse = "Acesse sua conta";
		   	    		  //Em ambiente mobile
		   	    		
		   	    		  if(ambienteMobile){

					   	      	if(portalParam.meuAcesso == "0"){
			   	    				scope.header.labelLinkAcesse = "";
			   	    				scope.header.linkAcesse = "";
			   	    			}
			   	    			
			   	    			if(portalParam.meuAcesso == "1"){
			   	    				scope.header.labelLinkAcesse = "Acesse sua conta";
			   	    				
			   	    				if($detection.isAndroid()){
						        		scope.header.linkAcesse = "https://play.google.com/store/apps/details?id=br.com.bb.android";	
						        	}else if ($detection.isiOS()){
						        		scope.header.linkAcesse = "https://itunes.apple.com/br/app/banco-do-brasil/id330984271?mt=8";
						        	}else if ($detection.isWindowsPhone()){
						        		scope.header.linkAcesse = "https://www.microsoft.com/pt-br/store/apps/banco-do-brasil/9wzdncrfj50d";
						        	}
			   	    				
			   	    			}
	
				   	      		if(portalParam.meuAcesso == "2"){
					   	      		scope.header.labelLinkAcesse = "Gerenciador Financeiro";
					   	      		
						   	      	if($detection.isAndroid()){
						        		scope.header.linkAcesse = "https://play.google.com/store/apps/details?id=br.com.bb.android.pj&hl=pt-BR";	
						        	}else if ($detection.isiOS()){
						        		
						        		var isIpad = $detection.getUserAgent().match(/iPad/i) != null;
						        	
						        		if(isIpad){
						        			scope.header.linkAcesse = "https://itunes.apple.com/br/app/gerenciador-financeiro-para/id401773150?mt=8";
						        		}else{
						        			scope.header.linkAcesse = "https://itunes.apple.com/br/app/gerenciador-financeiro/id928480113?mt=8";
						        		}
						        		
						        	}else if ($detection.isWindowsPhone()){
						        		scope.header.linkAcesse = "https://www.microsoft.com/pt-br/store/apps/gerenciador-financeiro/9nblggh1nvk8";
						        	}
					   	      	
				   	      		}
				   	      		 
				   	      		if(portalParam.meuAcesso == "3"){
					   	      		scope.header.labelLinkAcesse = "Acesse a conta";
						   	      		
						   	      	if($detection.isAndroid()){
						        		scope.header.linkAcesse = " https://play.google.com/store/apps/details?id=br.com.bb.android.gov&hl=pt-BR";        
						        	}else if ($detection.isiOS()){
						        		scope.header.linkAcesse = "https://itunes.apple.com/br/app/banco-do-brasil-governo/id417745530?mt=8";
						        	}else if ($detection.isWindowsPhone()){
						        		scope.header.linkAcesse = "https://www.microsoft.com/pt-br/store/apps/gerenciador-financeiro/9nblggh1nvk8";
						        	}
					   	      	
				   	      		}
		   	    			  
		   	    		  }else{
		   	    			scope.header.labelLinkAcesse = "Acesse sua conta";
		   	    			scope.header.linkAcesse = "https://www2.bancobrasil.com.br/aapf/login.jsp?aapf.IDH=sim&perfil=1";
		   	    			scope.header.escondeBotaoMeuAcesso=false;
		   	    			$rootScope.escondeBotaoMeuAcessoEBusca=false;
		   	    			
		   	    			if(portalParam.meuAcesso == "0"){
		   	    				scope.header.escondeBotaoMeuAcesso = true;
		   	    			}
		   	    			
		   	    			if(portalParam.meuAcesso == "20"){
		   	    				$rootScope.escondeBotaoMeuAcessoEBusca = true;
		   	    			}
		   	    			
		   	    			if(portalParam.meuAcesso == "1"){
		   	    				scope.header.linkAcesse = "https://www2.bancobrasil.com.br/aapf/login.jsp?aapf.IDH=sim&perfil="+portalParam.seguimento;
		   	    			}
		   	    			if(portalParam.meuAcesso == "2"){
				   	      		scope.header.labelLinkAcesse = "Gerenciador Financeiro";
			   	      			scope.header.linkAcesse = "https://aapj.bb.com.br/aapj/loginpfe.bb";
			   	      		}
			   	      		if(portalParam.meuAcesso == "3"){
				   	      		scope.header.labelLinkAcesse = "Acesse a conta";
			   	      			scope.header.linkAcesse = "https://aapj.bb.com.br/aapj/logingov.bb";
			   	      		}
			   	      	  }
		   	    		  
		   	    			/**
				   	    	 * Abre menu suspenso
				   	    	 */
					        setTimeout( function(){
					        	var mouseenterTimeout = false;
				        		var timeToClick = false;
				        		var cursorInside = false;
				        		var submenuActive = false;
				        		var $itemWithSubmenu = $('#account-access .menu .has-submenu');

				        		var openSubmenu = function() {
				        			$('body').addClass('menu-suspenso-ativo');
			        				$itemWithSubmenu.addClass('active');
			        				submenuActive = true;
				        		}
				        		var closeSubmenu = function() {
				        			$('body').removeClass('menu-suspenso-ativo');
			        				$itemWithSubmenu.removeClass('active');
			        				submenuActive = false;
				        		}
				        		var toggleMenuSuspenso = function() {
				        			if (submenuActive) {
				        				closeSubmenu();
				        			} else {
				        				openSubmenu();
				        			}
				        		}
				        			
				        		// Cursor dentro
				        		$itemWithSubmenu.mouseenter(function() {
				        			cursorInside = true;
				        			
				        			if (submenuActive) {
				        				timeToClick = true;
				        			} else {
					        			mouseenterTimeout = setTimeout(function() {
					        				timeToClick = true;
					        			}, 1000);
					        		}

					        		// Abre menu suspenso no hover do item do menu
					        		// delay para abrir caso o usuário não repouse o cursor no item
					        		setTimeout(function() {
					        			if (cursorInside) {
					        				openSubmenu();
					        			}
					        		}, 100);
				        		});

				        		// Abre/fecha menu suspenso no click do item do menu após 1s no hover
				        		$itemWithSubmenu.find('>a').click(function() {
				        			if (timeToClick === true) {
				        				toggleMenuSuspenso();
				        			}
				        		});

				        		// Cursor fora
					        	$itemWithSubmenu.mouseleave(function() {
					        		timeToClick = false;
					        		cursorInside = false;

					        		clearTimeout(mouseenterTimeout);

					        		// Fecha menu suspenso após 3s com o cursor fora
					        		if (submenuActive) {
					        			setTimeout(function() {
					        				if (cursorInside === false) {
					        					closeSubmenu();
					        				}
					        			}, 3000);
				        			}
				        		})
										
										// Fecha menu suspenso no click fora
				        		$(window).click(function() {
				        			if (submenuActive && cursorInside === false) {
				        				closeSubmenu();	
				        			}
				        		});

				        		// Fecha menu suspenso no evento scroll
				        		$(window).scroll(function() {
				        			if (submenuActive) {
				        				closeSubmenu();
				        			}
				        		});
					        }, 300);
		   	    		  
		   	    	  }//fim test undefined 
		   	    	  
	    	     });
    		 
        	}//IF da testeira A (fim)
        	
        	
        	$rootScope.escondeMenuHeader = false;
    		$rootScope.swithMenuHeader = function(){    	
    			
    			if($("body").hasClass("menuMobileAtivo")){
	    			//$("#view").removeClass("stopBody");
	    			$("body").removeClass("menuMobileAtivo");
    			}else{    				
    				//$("#view").addClass("stopBody");
    				$("body").addClass("menuMobileAtivo");
    			}    				
    			$rootScope.escondeMenuHeader = !$rootScope.escondeMenuHeader;
    		}; 
        	
          
        }
      };
    }) 
    .directive('bbFaleConosco', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/fale-conosco.html',
        scope: {data:'='},
        replace: true
      };
    })
    .directive('bbBreadcrumb', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/breadcrumb.html',
        replace: true,
        link: function(scope, element, attr) {
        	scope.$watch('listaMigalha', function() {
        		scope.exibeAtivo = function(boleana){
					if(boleana){
						return "migalhaAtiva";	
					}
	    		};
        		
        	});
        }
      };
    })
    .directive('bbBannerPromocional', function($rootScope, $timeout) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/bannerPromocional.html',
          replace: true,
          scope: {data:'='},
          link: function(scope, element, attr) {
        	  scope.$watch('data', function() {
        		  //console.log("entrou banner promocional");
        		  $timeout(function() {
        			  
                		var selector = '.containerBP'
                          , $wrapper = $(selector, element)
                          , itens = $wrapper.find('ul.scroller > li')
                          , scroll;


          			  if(itens.length > 1){ 
                		
                        // Calculate width
                        $wrapper.find('> ul.scroller').css('width', itens.length * 100 + '%');
                        itens.css('width', 100 / itens.length + '%');
                        //console.log(itens);
                        scroll = new IScroll($wrapper.get(0), {
                          eventPassthrough: true,
                          scrollX: true,
                          scrollY: false,
                          momentum: false,
                          snap: true,
                          snapSpeed: 600,
                          click: true
                        });
                        /*
                        scroll.on('scrollEnd', function() {
                          $(selector).find('ul.indicator > li.active').removeClass('active');
                          $(selector).find('ul.indicator > li:nth-child(' + (this.currentPage.pageX+1) + ')').addClass('active');
                        });
						*/

                        var quantBanners = $( 'ul.indicator > li' ).size();
                        var bannerAtual = 2;
                        var bulletAtual = 1;
                        var intervaloBannerPromocional = window.setInterval(function(){passaBanner();}, 5500);
                        
                        $wrapper.find('ul.indicator > li').click(function() {
                        	var position = parseInt($(this).attr('data-position')) + 1;
                        	bannerAtual = position;
                        	bulletAtual = position;

                        	scroll.scrollToElement(
                        		document.querySelector('.carrossel .containerBP li:nth-child(' + position + ')')
                        	);

                        	$(this).addClass('active').siblings('.active').removeClass('active'); 
                        });

                       var mudaBullet = function(bulletAtual){
                        	$( "ul.indicator > li.active").removeClass("active");
                        	$timeout(function() {
                        		$( "ul.indicator > li[data-position='"+ bulletAtual +"']" ).addClass("active");
                        	}, 600);
                        }  

                       var mudaBanner = function(bannerAtual){
                        	scroll.scrollToElement(
                        		document.querySelector('.carrossel .containerBP li:nth-child(' + bannerAtual + ')')
                        	);
                        	mudaBullet(bulletAtual);
                        }  

                      var passaBanner = function() {

                        	mudaBanner(bannerAtual);
                        	quantBanners = $( 'ul.indicator > li' ).size();

                        	if(bannerAtual < quantBanners){
                        		bannerAtual++;
                        		bulletAtual++;
                        	}else{
                        		bannerAtual = 1;
                        		bulletAtual = 0;
                        	}

                        }

                      intervaloBannerPromocional;
                      
          			  }
                  });
        	  },1000);
          }
        };
      })
   
    .directive('bbBoxIconCall', function($rootScope, fRedSiteExt) {
	  return {
		restrict : 'E',
		templateUrl : '/pbb/app/sites/comum/componentes/box-icon-call.html',
		replace : true,
		scope: {data:'='},
		link: function (scope, element, attr) {
			 scope.$watch('data', function() {
				 if(typeof(scope.data) != "undefined"){					
					scope.classencavalar = attr.classencavalar; 	
					scope.chamarLinkIconCall = function(endereco){
						if(endereco != ''){
							fRedSiteExt.redirecionarSiteExterno(endereco);
						}
		    		};
				 }
			 });
		}
	  };
	})
    .directive('bbLead', function($rootScope, $timeout) {
		return {
			restrict: 'E',       
			templateUrl: '/pbb/app/sites/comum/componentes/lead.html',
			replace: true,
			scope: {data:'='},
			link:function(scope){        	
				scope.$watch('data', function() { 
					if(typeof scope.data === 'object' && scope.data != null){      
						/** testar altura e largura da imagem vindas do publicador e setar "" quando 0
						* 	testar altura e largura da imagem vindas do publicador e remover attr's width height */       
						
						var locationUrl = window.location.href;
						var locationUrl_Array2 = locationUrl.split('/pbb');

						if(typeof scope.data.imagens === 'object' && scope.data.imagens != null && scope.data.imagens.length > 0){
							if(scope.data.imagens[0].largura == 0){
								scope.data.imagens[0].largura = "";        					
								$timeout(function() {
									$("#imgLead").removeAttr('width');
								}, 1000);
							}
							if(scope.data.imagens[0].altura == 0){
								scope.data.imagens[0].altura = "";        					
								$timeout(function() {
									$("#imgLead").removeAttr('height');
								}, 1000);
							}
											
							scope.data['locationImg'] = locationUrl_Array2[0]+"/pbb/"+scope.data.imagens[0].enderecoImagem;        			
							
						} else {
							var logoBB = locationUrl_Array2[0]+"/pbb/app/docs/pub/logo-bb-201x201.gif";				
							var logoBBPrivate = locationUrl_Array2[0]+"/pbb/app/docs/pub/logo-bb-private-201x201.gif";
							scope.data['locationImg'] = (portalParam.gtm.segmentoCliente.toLowerCase() == "private") ? logoBBPrivate : logoBB;		
							// scope.data['locationImg'] = locationUrl_Array2[0]+"/pbb/img.ImgWriter?codigo=2503&origem=CCI";
							// var caminhoImg = $(".logo a img").attr("ng-src");
							// scope.data['locationImg'] = locationUrl_Array2[0]+"pbb/"+caminhoImg;
							// console.log("caminhoImg",caminhoImg);
						}        			
						
						var locationUrl_Array = locationUrl.split('#');
						scope.data['location'] = locationUrl_Array[0];       			
					}        		 		
					
				});
			}        	
		};
	})
    .directive('bbCompartilhar', function($rootScope,fChamadaCompartilhar,$timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/compartilhar.html',
        replace: true,  link: function(scope, element, attr) {
        	scope.isCompartilharTop = false;
			scope.isCompartilharBottom = false;
			
        	fChamadaCompartilhar.getComponente().then(function(response) {
                if (response.success) {
                	if(response.componente != ""){
                	
                		scope.$watch('isLead', function() { 
	                		if(scope.isLead){

	                			$timeout(function(){
	                				// var faceID = 1497135607257510; //old 289255557788943
	                				// var faceID = portalParam.facebookKey; //old 289255557788943
	                				// console.log(portalParam.facebookKey === 1497135607257510, "4 portalParam.facebookKey", portalParam.facebookKey, "faceID", faceID);
	                			
	                				if(typeof(response.componente[0].tags) != 'undefined'){
		                				
		                				if(response.componente[0].tags[0].nomeTag.trim() == "Inferior"){
			    	                		scope.isCompartilharTop = false;
			    	                		scope.isCompartilharBottom = true;
			    	                	}else{
			    	                		scope.isCompartilharBottom = false;
				                			scope.isCompartilharTop = true;
			    	                	}
		                				
		                				if(!mapeouCompartilhar){
		                					new ShareBar({'facebookAppId': portalParam.facebookKey});
		                					mapeouCompartilhar = true;
		                				}
		                			}else{
		                				scope.isCompartilharBottom = false;
			                			scope.isCompartilharTop = true;
			                			if(!mapeouCompartilhar){
			                				new ShareBar({'facebookAppId': portalParam.facebookKey});
			                				mapeouCompartilhar = true;
		                				}
		                			}                					    	                		
		                		}, 500);                					    	                		
	    	                }
	                		
	                		
	                		
                		});
                		
	                }
                 }
            });        	
    		
          }
      };
    })
    .directive('bbImgBanner', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/img-banner.html',
        replace: true,
        scope: {data:'='}
      };
    })
    .directive('bbInfoGeral', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/info-geral.html',
        replace: true,
        scope: {data:'='}
      };
    })
    .directive('bbBoxFone', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/fone.html',
        replace: true,
        scope: {data:'='}
      };
    })
    .directive('bbAnexoArquivos', function($rootScope) {
      return {
        restrict: 'E',
        scope: {data:'='}, 
        templateUrl: '/pbb/app/sites/comum/componentes/anexo-arquivos.html',
        replace: true
      };
    })
    .directive('bbNecessidade2', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/necessidade2.html',
        replace: true,
        scope: {data:'='},
        link: function(scope, el, attrs) {
            scope.goNecessidades2 = function(endereco) {
              if(endereco.trim() != '')
                 fRedSiteExt.redirecionarSiteExterno(endereco.trim());
            };
        }
      };
    })
    .directive('bbNecessidade1', function($rootScope, $timeout, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/necessidade1.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el, attrs) {
        	
        	scope.$watch('data', function() {
        		
        		
       		 $timeout(function(){
        		var data = scope.data;
        		if(typeof(data) != "undefined"){ 
        				
	        		if((typeof(data) != "undefined") && (data.banners && data.banners.length > 0 && data.banners[0].imagem != null && data.banners[0].imagem.enderecoImagem != null)){					
						data["clss_contClass"] = "contClass";  
	    				data["isImagem"] = true;
	    				data["classTitulo"] = "tituloImagem";
	    				data["classTexto"] = "textoImagem";
	    			}else{    				
	    				data["clss_noMargin"] = "noMargin";  
	    				data["clss_newFont"] = "newFont";  
	    				data["isImagem"] = false;  
	    				data["classTitulo"] = "titulo";
	    				data["classTexto"] = "texto";
	    			}
	    							
	    			if(data.textoDescricaoGrupoChamadas.indexOf(">>") != -1){    						
	                	var descSplit = data.textoDescricaoGrupoChamadas.split('>>');                	
	                	data["textoLink"] = descSplit[1];
	                	data.textoDescricaoGrupoChamadas = descSplit[0];                	
	            	}

	    			scope.chamarLink = function(endereco){
	    				fRedSiteExt.redirecionarSiteExterno(endereco);
	        		};
	    			
	    			scope.data = data;
	    			
        		}

       		 },1600);
       	
       	
       	});
        	
    	}
      };
    })
    
    .directive('bbNecessidade3', function ($rootScope, $timeout, fRedSiteExt) {
        return {
            restrict: 'E',
            templateUrl: '/pbb/app/sites/comum/componentes/necessidade3.html',
            replace: true,
            scope: {data: '='},
            link: function (scope, el, attrs) {

                scope.$watch('data', function () {


                    $timeout(function () {
                        var data = scope.data;
                        if (typeof (data) != "undefined") {

                            if ((typeof (data) != "undefined") && (data.banners && data.banners.length > 0 && data.banners[0].imagem != null && data.banners[0].imagem.enderecoImagem != null)) {
                                data["clss_contClass"] = "contClass";
                                data["isImagem"] = true;
                                data["classTitulo"] = "tituloImagem";
                                data["classTexto"] = "textoImagem";
                            } else {
                                data["clss_noMargin"] = "noMargin";
                                data["clss_newFont"] = "newFont";
                                data["isImagem"] = false;
                                data["classTitulo"] = "titulo";
                                data["classTexto"] = "texto";
                            }

                            if (data.textoDescricaoGrupoChamadas.indexOf(">>") != -1) {
                                var descSplit = data.textoDescricaoGrupoChamadas.split('>>');
                                data["textoLink"] = descSplit[1];
                                data.textoDescricaoGrupoChamadas = descSplit[0];
                            }

                            scope.chamarLink = function (endereco) {
                            	fRedSiteExt.redirecionarSiteExterno(endereco);
                            };

                            scope.data = data;

                        }

                    }, 1600);


                });

            }
        };
    })
    
    .directive('bbBeneficiosHome', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/beneficiosHome.html',
        replace: true,
        scope: {data:'='},
        link:function(scope){
        	
        	scope.$watch('data', function() { 
        		if(typeof(scope.data) != "undefined"){
        		
        			scope.isBeneficiosHomeConteudo = true;
        	    	scope.isBeneficiosHomeIcons = false;
        	    	scope.isBeneficiosHomeLinkInterno = false;
        	    	scope.isBeneficiosHomeLinkExterno = false;
        	    	scope.isBeneficiosHomeText = false;
        			
        			var data = scope.data;
        					
					var index_chamada1 = 0;
					angular.forEach(data.chamada1, function(value, key){ 			//testando se chamada1 tem dados
						index_chamada1 = 1;
					});
					var index_listaChamadas2 = 0;
					angular.forEach(data.listaChamadas2, function(value, key){	 	//testando se listaChamadas2 tem dados
						index_listaChamadas2 = 1;
						if(data.listaChamadas2[key].enderecoPaginaChamada.trim() != ""){
							scope.clss_cursorDefalut = '';
							//alert("endereço veio");
						}else{
							scope.clss_cursorDefalut = 'cursorDefault';
							//alert("endereço não veio");
						}
						
					});
					
					var index_menu = 0;
					angular.forEach(data.menu, function(value, key){	 			//testando se menu tem dados
						index_menu++;
						data.menu[key].link = data.menu[key].link.trim();
					});
					
					
					//if(data.menu[6])
					
					
					scope.clss_widhtMenu = '';
					
					scope.widhtMenu = function(wdt) {	
						if(index_menu == 1){scope.clss_widhtMenu = 'widhtMenu_100'};
		    			if(index_menu == 2){scope.clss_widhtMenu = 'widhtMenu_50' };
		    			if(index_menu == 3){scope.clss_widhtMenu = 'widhtMenu_33' };
		    			if(index_menu == 4){scope.clss_widhtMenu = 'widhtMenu_25' };
		    			if(index_menu == 5){scope.clss_widhtMenu = 'widhtMenu_20' };
		    		    return scope.clss_widhtMenu;
					}
								   			
					    			   			
					if(index_chamada1 == 0 && index_listaChamadas2 == 0){
						scope.isBeneficiosHomeConteudo = false;			
					}
					
					if(!scope.isBeneficiosHomeConteudo){
						scope.clss_no_marginTop = 'no_marginTop';
					}else{
						scope.clss_no_marginTop = '';
					}
					
					
					if(scope.isBeneficiosHomeConteudo){
						        			
		    			scope.goBeneficiosHome = function(endereco) {
		    				if(endereco.trim() !=""){
		    					fRedSiteExt.redirecionarSiteExterno(endereco);

		    				}	  
		                };
		                scope.goBeneficiosHomeIcons = function(endereco) {
		    				if(endereco.trim() !=""){
		    					fRedSiteExt.redirecionarSiteExterno(endereco);
		    				}
		                };
		                
		                //data.chamada1.texto="aola pla ola $$oi$$>>sdcvbsdkv  ncja  $$sdjdsbvk$$ sdvsdu";
		                //data.chamada1.enderecoPaginaChamada="www.google.com";
		                
		                if(index_chamada1 != 0){
		        			if(index_listaChamadas2 == 1 && ( data.chamada1.texto !="" || data.chamada1.texto.trim() != ".") && data.chamada1.texto.indexOf(">>") != -1){
		        				scope.isBeneficiosHomeLinkInterno = true;
		        			}else{}
		        			
		        			if(index_listaChamadas2 == 0 && ( data.chamada1.texto !="" || data.chamada1.texto.trim() != ".")){
		        				scope.isBeneficiosHomeLinkExterno = true;
		        			}else{}
		    			
		    			}   
		                
		                if(index_chamada1 != 0){
		                	
		                	if(data.chamada1.texto.indexOf(">>") != -1){                /*split TEXT and LINK case >> */
			                	var textoSplit = data.chamada1.texto.split('>>');
			                	data.chamada1.texto = textoSplit[0];
			                	data.chamada1["txtLink"] = textoSplit[1];
			                	/*-----------------------------------------------------*/  
			                	var textoIniLink = "";									/*font bold case $$ $$ LINK*/				
			             	    var textoMeioLink = "";
			             	    var textoFimLink = "";
			             	    var textoTratadoLink ="";
			             	    var primeiraOcLink = -1;
			             	    var segundaOcLink = -1;
			             	    var primeiraOcLink = textoSplit[1].indexOf("$$");
			             	    var segundaOcLink = textoSplit[1].lastIndexOf("$$");
			             	    if(primeiraOcLink != -1 && segundaOcLink != -1){
			             	    	textoIniLink = textoSplit[1].substring(0,primeiraOcLink);
			             	    	primeiraOcLink = primeiraOcLink + 2;
			             	    	segundaOcLink = segundaOcLink;
			             	    	textoMeioLink = textoSplit[1].substring(primeiraOcLink, segundaOcLink);
			             	    	segundaOcLink = segundaOcLink + 2;
			             	    	textoFimLink = textoSplit[1].substring(segundaOcLink, textoSplit[1].length);
			             	    	textoTratadoLink = textoIniLink+"<b>"+textoMeioLink+"</b>"+textoFimLink;
			             	    	textoSplit[1] = textoTratadoLink;
			             	    	data.chamada1["txtLink"] = textoTratadoLink;
			             	    }
			             	   /*-----------------------------------------------------*/
			             	    var textoIniDf = "";								   /*font bold case $$ $$ TEXT*/	
		   	             	    var textoMeioDf = "";
		   	             	    var textoFimDf = "";
		   	             	    var textoTratadoDf ="";
		   	             	    var primeiraOcDf = -1;
		   	             	    var segundaOcDf = -1;
		   	             	    var primeiraOcDf = textoSplit[0].indexOf("$$");
		   	             	    var segundaOcDf = textoSplit[0].lastIndexOf("$$");
		   	             	    if(primeiraOcDf != -1 && segundaOcDf != -1){
		   	             	    	textoIniDf = textoSplit[0].substring(0,primeiraOcDf);
		   	             	    	primeiraOcDf = primeiraOcDf + 2;
		   	             	    	segundaOcDf = segundaOcDf;
		   	             	    	textoMeioDf = textoSplit[0].substring(primeiraOcDf, segundaOcDf);
		   	             	    	segundaOcDf = segundaOcDf + 2;
		   	             	    	textoFimDf = textoSplit[0].substring(segundaOcDf, textoSplit[0].length);
		   	             	    	textoTratadoDf = textoIniDf+"<b>"+textoMeioDf+"</b>"+textoFimDf;
		   	             	    	textoSplit[0] = textoTratadoDf;
		   	             	    	data.chamada1.texto = textoSplit[0];
		   	             	    }
			   	             	if(textoTratadoLink !="" ){ 	/*oculta link do blocoMain quando texto = "." */
		            				scope.isBeneficiosHomeText = true;
		                    	}
			                	
		                	}	
		                	
		                	if(data.chamada1.texto.trim() == "."){
		                		data.chamada1.texto="";
							}
		                }
		    			
		                var textoIniDf = "";								   /*font bold case $$ $$ TEXT*/	
		         	    var textoMeioDf = "";
		         	    var textoFimDf = "";
		         	    var textoTratadoDf ="";
		         	    var primeiraOcDf = -1;
		         	    var segundaOcDf = -1;
		         	    
		         	   if(data.chamada1 != null)
			         	    var primeiraOcDf = data.chamada1.texto.indexOf("$$");
			         	    
		         	   if(data.chamada1 != null)
			         	    var segundaOcDf = data.chamada1.texto.lastIndexOf("$$");
			         	    
		         	    if(primeiraOcDf != -1 && segundaOcDf != -1){
		         	    	textoIniDf = data.chamada1.texto.substring(0,primeiraOcDf);
		         	    	primeiraOcDf = primeiraOcDf + 2;
		         	    	segundaOcDf = segundaOcDf;
		         	    	textoMeioDf = data.chamada1.texto.substring(primeiraOcDf, segundaOcDf);
		         	    	segundaOcDf = segundaOcDf + 2;
		         	    	textoFimDf = data.chamada1.texto.substring(segundaOcDf, data.chamada1.texto.length);
		         	    	textoTratadoDf = textoIniDf+"<b>"+textoMeioDf+"</b>"+textoFimDf;
		         	    	data.chamada1.texto = textoTratadoDf;
		         	    }
		    			
		    			if(index_listaChamadas2 == 1){
		    				scope.isBeneficiosHomeIcons = true;
		    			}else{}
		    			
		    			if(!scope.isBeneficiosHomeIcons || index_chamada1 == 0){  	/*altura fixa quando isBeneficiosHomeIcons != false*/
		    				scope.clss_isBeneficiosHomeIcons = 'altutaForced';
		    			}else{
		    				scope.clss_isBeneficiosHomeIcons = '';
		    			}
		    			
        	
		    			scope.data = data;
		    			
		    			
		    			
					}
				}	
				});
    	
        	
        }
      };
    })
    .directive('bbBoxConteudo', function($rootScope, $sce) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/box-conteudo.html',       
        replace: true,
        scope: {data:'='}, 
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {
        		if(typeof(scope.data) != "undefined"){
        			
            		angular.forEach(scope.data.noticias, function(noticias, key){
            			
            			angular.forEach(noticias.tags, function(tags){
            				
            				if(tags.nomeTag === "lyt-transparente"){
            					
            					scope.data.noticias[key].lytTransparent = true;
            					
            				};
            			});
            		});
	    		};
	        	scope.trustHtmlBoxCont = function(string) {
	                 return $sce.trustAsHtml(string);
	            }
        	});
        }
      };
    })
    .directive('bbCallToAction', function ($rootScope, $timeout,$filter) {
		return {
			restrict: 'E',
			templateUrl: '/pbb/app/sites/comum/componentes/callToAction.html',
			replace: true,
			link: function (scope, el, attrs) {
	
				scope.$watch('callToActions', function () {
					
					scope.isImgSuperior = function(call) {	
						var isImgSuperior = true;
						angular.forEach(call.tags, function(value, key){
							if(value.nomeTag == 'Inferior') {									
								isImgSuperior = false;																	
							}								
						});
						
						return isImgSuperior;
					}
		
					$timeout(function () {
					
						if (typeof (scope.callToActions) != "undefined") {
						
							scope.classStrResponsive = "teste";
							if (typeof (scope.callToActions.chamada) != "undefined") {
								scope.classStrResponsive += $filter('bbFilterClassResponsive')(scope.callToActions.chamada); 	
							}
							
		
							/* solução paleativa para mensuração dos callTOActions */
							/* solução paleativa para mensuração dos callTOActions */
							 var mensurarCallToActions = function(event){
								 	var modoDebug = true;
							    	var atrubutoMensuravel;
							    	var labelComponente;
							    	if(event.type == 'click'){
							    		atrubutoMensuravel = $(event.currentTarget).attr("data-mensuravel-callToAction");    		
							    	}else if(event.type == 'keypress'){
							    		atrubutoMensuravel = $(event.currentTarget).attr("data-mensuravel-callToAction");
							    	}
							    	var dados           = atrubutoMensuravel.split("|");
									var tipoLeitor      = dados[0].trim();
									var tipoComponente  = dados[1].trim();
									if(dados[2] === undefined || dados[2] === null) {dados[2] = "";}		
									((event.type == 'click') ? labelComponente = dados[2].trim() : labelComponente = $(event.currentTarget).val());			
									if(dados[3] === undefined || dados[3] === null || dados[3] === "") {
										dados[3] = "0";
									}
									var codComponente = dados[3].trim();
									if(tipoLeitor == "an"){
										if(modoDebug){
							  				console.log(
							  						  ' Mensurando (Google Tag Manager) ' 
							  						+ '	\n eventoCategoria: '+  portalParam.gtm.segmentoCliente+((typeof portalParam.gtm.categoria !== 'undefined' && portalParam.gtm.categoria != "")? '_'+portalParam.gtm.categoria : '')
							  						+ ' \n eventoAcao: ' +  tipoComponente
							  				      	+ ' \n eventoRotulo: ' +  labelComponente
							  				);
										}
										//analitics - com googleTagManager
							  			dataLayer.push({
								                'event' : 'GAEvent' , 
								      'eventoCategoria' :  portalParam.gtm.segmentoCliente+((typeof portalParam.gtm.categoria !== 'undefined' && portalParam.gtm.categoria != "")? "_"+portalParam.gtm.categoria : ""), 
								      	   'eventoAcao' :  tipoComponente,
								      	 'eventoRotulo' :  labelComponente
								      	});
							  			
										if(modoDebug)
											console.log(dataLayer);
											
									}else{
										if(modoDebug)		
											console.log('>>> Parametro Invalido: '+tipoLeitor);
									}
									
							    }
							 /* solução paleativa para mensuração dos callTOActions */
							
							
							/** Recarrega bootstrap **/
							var recuperaClass = function() {
								bootstrapCollapse;
								               			   
								$('.collapse').on('show.bs.collapse', function () {
									$(this).parent().siblings().removeClass('selected');
								}).on('shown.bs.collapse', function () {
									$(this).parent().addClass('selected');
								}).on('hide.bs.collapse', function () {
									if ($(this).attr('aria-expanded') == 'true') {
										if ($(this).parent().hasClass('selected')) {
											return false;
										}
									}
								});
							};
							
							/** Recarrega bootstrap **/
							var reloadBootstrap = function() {
								bootstrapCollapse;
								               			   
								$('.collapse').on('show.bs.collapse', function () {
									$(this).parent().siblings().removeClass('selected');
								}).on('shown.bs.collapse', function () {
									$(this).parent().addClass('selected');
								}).on('hide.bs.collapse', function () {
									if ($(this).attr('aria-expanded') == 'true') {
										if ($(this).parent().hasClass('selected')) {
											return false;
										}
									}
								});
								
								//MAPEAMENTO PALEATIVO PARA O CALL TO ACTION
								 $('[data-mensuravel-callToAction]').on('click', function(event) {
								    	if(!$(this).hasClass("gtm")){
								    		mensurarCallToActions(event);			
								    	}
								});
							};

							var limpaRemove = function(operador) {
								
								switch (operador) {
								case 0:
									$("#preCallToAction").html("");
									break;
								case 1:
									$("#callToActionTrigger").html("");
									break;
								case 2:
									
									break;
								case 3:
									$("#callToActionTriggerSmart").html("");
									break;
								case 4:
									$("#callToActionTriggerSmart").remove();
									break;
								case 5:
									
									break;

								default:
									break;
								}
								               			   
							};
							
							
							var W = (typeof window.innerWidth == "undefined") ? document.documentElement.offsetWidth : window.innerWidth;
							
							if (W >= 769) {							
								if(scope.preCallToAction == null || scope.preCallToAction == undefined) {
									scope.preCallToAction = $("#preCallToAction").html(); 
								} 
								limpaRemove(0);
								limpaRemove(1);
								$("#callToActionTrigger").html(scope.preCallToAction);
								
								
							} else {
								if(scope.preCallToAction == null || scope.preCallToAction == undefined) {
									scope.preCallToAction = $("#preCallToAction").html(); 
								} 
								
								limpaRemove(0);//#preCallToAction
								
								if($("#callToActionTriggerSmart").length == 0) {
									if($("#pbb-lead").length > 0) {
										$("#pbb-lead").after("<div id='callToActionTriggerSmart'>"+scope.preCallToAction+"</div>");
									}
								} else {
									if($("#callToActionTriggerSmart .callToAction").length == 0){
										$("#callToActionTriggerSmart").html("");
										$("#callToActionTriggerSmart").html(scope.preCallToAction);
									}
								}
							
							}
							
							
							reloadBootstrap();
							
							  

							var mapeado = false;
							var rolagemCallToAction = function () {
								if (!mapeado) {
									$(window).scroll(function () {

										/**Get document height (cross-browser)*/
										function getDocHeight() {
											var D = document;
											return Math.max(
												D.body.scrollHeight, D.documentElement.scrollHeight,
												D.body.offsetHeight, D.documentElement.offsetHeight,
												D.body.clientHeight, D.documentElement.clientHeight
												);
										}
										/**End*/

										         	    	            
										var w = (typeof window.innerWidth == "undefined") ? document.documentElement.offsetWidth : window.innerWidth;
										    	    	            
										var quantidadeCallToAction = $('.callToAction').length;//$('.callToAction [ng-hide=false]').length;
										
											var qtdCallToActionBranco = $('.callToActionWhite').length;
											var qtdCallToActionBrancoDesktop = 0;
											
											if(qtdCallToActionBranco > 0 ){
												var temOutrasFronteiras = false;
												if($('.callToActionWhite.isTablet').length > 0){
													temOutrasFronteiras = true;
												}else if($('.callToActionWhite.isSmartphone').length > 0){
													temOutrasFronteiras = true;
												}else if($('.callToActionWhite.isDesktop').length > 0){
													temOutrasFronteiras = true;
													qtdCallToActionBrancoDesktop = $('.callToActionWhite.isDesktop').length;
												}
											
												if(!temOutrasFronteiras){
													qtdCallToActionBrancoDesktop = qtdCallToActionBranco;
												}	
											}
											
											quantidadeCallToAction += qtdCallToActionBrancoDesktop;
											
											console.log("Quantidade de Call To Actions Branco", qtdCallToActionBrancoDesktop);
											
										if (quantidadeCallToAction == 1 && w >= 769) {

											if ($(this).scrollTop() > $(".callToActions:eq(0)").offset().top) {
												$('.callToAction').addClass('newsletter');
												$('.callToAction').css("position", "fixed");
										         	    	            	    
											} else {
												$('.callToAction').removeClass('newsletter');
												$('.callToAction').css({"position": "relative", "width": "auto"});
											}
											$('.newsletter').css("width", $(".callToActions:eq(0)").width() + "px");

											var H = (typeof window.innerHeight == "undefined") ? document.documentElement.offsetHeight : window.innerHeight;
											var descHeigth = 0;
											if ($('.callToAction').length > 0)
												descHeigth += $('.callToAction').height() + 30;
											if ($('.section-relacionados').length > 0)
												descHeigth += $('.section-relacionados').height() + 30;
											if ($('section.carrossel').length > 0)
												descHeigth += $('section.carrossel').height() + 50;
											if ($(this).scrollTop() + descHeigth > $("#global-footer").offset().top) {
												$('.callToAction').removeClass('newsletter');
												$('.callToAction').css("display", "none");
											} else {
												$('.callToAction').css("display", "block");
											}
										}
									});
									mapeado = true;
								}
							}
							rolagemCallToAction();
							$(window).resize(function () {
								if (typeof window.timeResize == 'undefined')
									window.timeResize = setTimeout(function () {}, 0);
									clearTimeout(window.timeResize);
									window.timeResize = setTimeout(function () {
										var W = (typeof window.innerWidth == "undefined") ? document.documentElement.offsetWidth : window.innerWidth;
										if (W >= 769) {
											$('.newsletter').css("width", $(".callToActions:eq(0)").width() + "px");
											//calltoaction
											if(scope.preCallToAction == null || scope.preCallToAction == undefined) {
												scope.preCallToAction = $("#preCallToAction").html(); 
											} 
											
											limpaRemove(0);//#preCallToAction
											limpaRemove(4);//##callToActionTriggerSmart
											$("#callToActionTrigger").html(scope.preCallToAction);	
											reloadBootstrap();
											
										}else {
											$('.callToAction').css({"position": "relative", "width": "auto", "display": "block"});
											
											//para mobile e tablet
											if(scope.preCallToAction == null || scope.preCallToAction == undefined) {
												scope.preCallToAction = $("#preCallToAction").html(); 
											} 
											
											limpaRemove(4);//#callToActionTrigger
											
											if($("#pbb-lead").length > 0) {
												
												limpaRemove(4);//#callToActionTriggerSmart
												$timeout(function () {
													$("#pbb-lead").after("<div id='callToActionTriggerSmart'>"+scope.preCallToAction+"</div>");
													$timeout(function () {
														reloadBootstrap();	
													}, 100);	
												}, 200);
												
												
											} else {
												
												if($("#callToActionTriggerSmart .callToAction").length == 0){
													
													limpaRemove(4);//##callToActionTriggerSmart
													$timeout(function () {
														$("#callToActionTriggerSmart").html(scope.preCallToAction);
														$timeout(function () {
															reloadBootstrap();
														}, 100);	
													}, 200);
													
												}
												
											}
																					
																													
										}
										
										
									}, 200);
							});

						}
					
						//TODO se precisar descomentar. em caso de templates com colunas mistas com e sem call to action.
						//scope.classIsCallToAction = "iscall";

												
					}, 500);
				});
			}
		};
	})

    .directive('bbBoxProdutos', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/box-produtos.html',
        replace: true,
        link: function (scope){
        	
        	scope.$watch('data', function() {
        	
	        	scope.chamarLink = function(endereco){
	        		fRedSiteExt.redirecionarSiteExterno(endereco);
	    		};
	    		
	    		scope.textoLink = function(){
					$(".section-produto").find("li").each(function(){
						var texto = $(this).find(".texto").text();
						
						if($(this).find(".texto").length > 0){
							var $container = $(this).find(".texto");
							var alturaContainer = $container.css('height');
							var alturaHidden = $container[0].scrollHeight - 2;
							alturaContainer = parseInt(alturaContainer.replace('px',''))+5;	
							while ( alturaHidden > alturaContainer ) {
								$container.text(function (index, text) {
						            return text.replace(/\W*\s(\S)*$/, '...');
						       });
							   alturaHidden = $container[0].scrollHeight;
							}
						}
	
					});    			
	    		};
					    		
					    		
					    		
        	});
			
        }
        
      };
    }) 
    .directive('bbBoxProdutosHome', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/box-produtosHome.html',
        replace: true,
        link:function(scope){
        	 scope.$watch('data', function() {
        		 /*scope.data.chamada.titulo = "$$TESTE$$ >> link";
        		 scope.data.chamada.texto = "CARRO";
        		 console.log(scope.data.chamada.titulo);*/
        		 scope.goboxProdutosHome = function(endereco) {
        			if(endereco.trim() !=""){
     					fRedSiteExt.redirecionarSiteExterno(endereco);
     				}
                 }
        	 });
        	
        }
      };
    }) 
    .directive('bbBoxLink', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/box-link.html',
        replace: true,
        scope: {data:'='}, 
        link: function (scope) {
          scope.$watch('data', function() {

            scope.chamarLink = function(endereco){
            	if(typeof endereco !== 'string') return;              
                if(!endereco.trim() == ""){                  
                  fRedSiteExt.redirecionarSiteExterno(endereco);
                }
            };    

          });

        }
      };
    }) 
    .directive('bbBeneficios', function($rootScope, $timeout, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/beneficios.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el , attrs){
        	
        	scope.$watch('data', function() {
        		
        		
        		 $timeout(function(){
		        		var data = scope.data;   
		        		if(typeof(data) != "undefined"){
				        	
			        		angular.forEach(data, function(value, key){	    	    				
				    			if(data.textoDescricaoGrupoChamadas.indexOf(">>") != -1){
				        			var textoSplit = data.textoDescricaoGrupoChamadas.split('>>');
				                	data.textoDescricaoGrupoChamadas = textoSplit[0];
				                	data["txtLink"] = textoSplit[1];
				                	
				                	if(data.txtLink.trim() != "" && data.linkGrupoChamadas.trim() != ""){
				                		scope.isBeneficiosLink = true;
				                		data["beneficiosCursor"] = 'cursorPointer';
					        		}else{
					        			data["beneficiosCursor"] = '';
					        		}
				            	}
								scope.chamarLinkBeneficios2 = function(endereco){            			
				    				if(endereco.trim() != ""){        					
				    					fRedSiteExt.redirecionarSiteExterno(endereco);

				    				}else{
				    				}
				        		};    	 	        		
				    		});
							
			        		
				    		angular.forEach(data.chamadas, function(value, key){	    	        			
				    			if(data.chamadas[key].texto.indexOf(">>") != -1){
				        			var textoSplit = data.chamadas[key].texto.split('>>');
				        			data.chamadas[key].texto = textoSplit[0];
				                	data.chamadas[key]["txtLinkInterno"] = textoSplit[1];
				                	
				                	if(data.chamadas[key].txtLinkInterno.trim() != "" && data.chamadas[key].enderecoPaginaChamada.trim() != ""){
				                		data.chamadas[key]["islinkBeneficios"] = true;
				                		data.chamadas[key]["beneficiosCursor"] = 'cursorPointer';	
				                		data.chamadas[key]["linkAtivado"] = true;
					        		}else{
					        			data.chamadas[key]["islinkBeneficios"] = false;
					        			data["beneficiosCursor"] = '';	     
					        			data.chamadas[key]["linkAtivado"] = false;
					        		}		        			
				            	}else{
				            		data.chamadas[key]["linkAtivado"] = false;
				            	}     			
				    		});
				    		
				    		scope.chamarLinkBeneficios = function(endereco, link){        			
								if(endereco != "" && link == true){    					
									fRedSiteExt.redirecionarSiteExterno(endereco);			
								}else{    					
								}
				    		};
				    		
				    		
				    		scope.data = data;
			    		
		        		}
						    		
						    		
        		 
        		 },600);
        	
        	
        	});
    		
    		
        	
        }
      };
    }) 
    .directive('bbMaisInfo1', function($rootScope, $sce) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/mais-info-1.html',
        replace: true,
        scope: {data:'='},     
        link: function (scope, el, attrs) {     
        	scope.selectTabInfo1 = function(index){
                if(scope.selectedTab != index){
                  scope.selectedTab = index;
                }else{
                  scope.selectedTab = 5000;
                }                  
                               
                setTimeout(function(){
                	$("html, body").animate({ scrollTop: $("#mInfo"+index).offset().top - 120 }, 200);
            	}, 100);                                                      
                
          }    
          
          scope.trustHtmlBoxCont = function(string) {
                return $sce.trustAsHtml(string);
          }; 
    	}      
      };
    }) 

    .directive('bbMaisInfo50', function($rootScope, $sce) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/mais-info-50.html',
        replace: true,
        scope: {data:'='},     
      	link: function (scope, el, attrs) {  			
      		scope.selectTabInfo50 = function(index){
	            	if(scope.selectedTab != index){
	            		scope.selectedTab = index;
	            	}else{
	            		scope.selectedTab = 5000;
	            	}	 	                
	             }    
  			scope.trustHtmlBoxCont = function(string) {
                return $sce.trustAsHtml(string);
            }; 
      	}      
      };
    }) 
   
    .directive('bbAccordionExplorar', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/accordion-explorar.html',
        replace: true,
        //scope: {data:'='},
      
      	link: function (scope, el, attrs) {
      		scope.filtroBuscaFaqByTags = function(el){
        		//console.log('ng-click:', el);
        		$rootScope.tagsBuscaFaq= el;		
        	};
      		
			//var lista_Li = el.find('li');   
			$('#content').on('click', '.liMenuAccordion', function(e){
    			
				if( ['li','h1'].indexOf(e.target.localName) != -1 ){
					
        			if($(this).hasClass('selected')){        				
        				$(this).removeClass('selected');        				 
        			}else{
        				$('.liMenuAccordion').removeClass('selected');
        				$(this).addClass('selected');
        			}
        			
				}
    			
    			
    		});
  			
      	}
        
      
      };
    })
    
    .directive('bbNavSecundaria', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/nav-secundaria.html',
        replace: true,
      
      	link: function (scope, el, attrs) {
      		scope.filtroBuscaFaqByTags = function(el){
        		$rootScope.tagsBuscaFaq= el;		
        	};
      		   
			$('#content').on('click', '.liMenuNavSecundaria', function(e){
    			
				if( ['li','h1'].indexOf(e.target.localName) != -1 ){
					
        			if($(this).hasClass('selected')){        				
        				$(this).removeClass('selected');        				 
        			}else{
        				$('.liMenuNavSecundaria').removeClass('selected');
        				$(this).addClass('selected');
        			}        			
				}
    		});	
      	}
      };
    })
    
        .directive('bbBuscaInterna', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/busca-interna.html',
        replace: true,
        link: function (scope, el, attrs,ENI) {
        	scope.filtroBuscaFaq = function(el){
        		//console.log('ng-change:', el);
        		if(el.length >= 3){
        			$rootScope.$emit('textoBuscaFaq', el);
        		}else if(el.length < 3 || el == ""){
        			$rootScope.$emit('textoBuscaFaq', "");
        		}
        	};
        	scope.limpaBuscaInterna = function(){
        		$('#textoBuscaFaq').val('');
        	};
        	
        }
      };
    })
      
    
    
    
    .directive('bbMaisInfo2', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/mais-info-2.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el, attrs,ENI) {
        	scope.$watch('data', function() {	
        		if(scope.data != null && scope.data != ""){
	        			 
		        		var tempLista = scope.data.faq;
		        		scope.totalPorPagina = 20;
		        		scope.totalRegistro = tempLista.length;
		        		scope.paginasFaq = [];
		        		scope.contadorItensPaginacao = 1;
		        		var p = scope.totalRegistro > scope.totalPorPagina ? Math.ceil(scope.totalRegistro / scope.totalPorPagina) : 1;
		        		for (var i = 0; i < p; i++) {
		        			scope.paginasFaq.push(tempLista.splice(0, scope.totalPorPagina));
		        		}
		        		
		        		scope.listaFaq = scope.paginasFaq[0];
		 	       
		        		scope.loadListPagination = function (i) {

		        			$('html, body').animate({
								scrollTop: $('.mais-info-2').offset().top
							}, 200);
		        			
		        			scope.selectedTab = 5000;
		 	                if(i == 0){
		 	                	scope.contadorItensPaginacao = 1;	
		 	                }else{
		 	                	scope.contadorItensPaginacao = i*scope.totalPorPagina+1;
		 	                }
		 	                scope.listaFaq = scope.paginasFaq[i];
		 	                
		        		}; 	            
	 	            
		 	            scope.selectTabInfo2 = function(index){
		 	            	if(scope.selectedTab != index){
		 	            		scope.selectedTab = index;
		 	            	}else{
		 	            		scope.selectedTab = 5000;
		 	            	}	 	                
		 	             }    
		 	             scope.insereEstatistica = function(codigosFaqCham){
		 	            	
		 	            	var isPesquisa = false;
		 	        		try {
		 	        			var identificador = new IdentificadorBB();
		 	        	    	isPesquisa = true; 
		 	        	        if(isPesquisa){
		 	        	        	identificador.gravaCookieCliente();
	 	    						identificador.contaObjetoExterno(1, 0,'CHMD_1', codigosFaqCham ,''); 	    					
		 	    				}			
		 	        		}catch(e){ 
		 	        		
		 	        		}
		 	        	}
	        		}
	        	 	        	
    		});
    	}
    		
      };
    }) 
    .directive('bbMaisInfoEsp', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/mais-info-esp.html',
        replace: true,
        link: function (scope, el, attrs,ENI) {	
        	scope.$watch('maisInfoEsp', function() {	
	        	if(scope.maisInfoEsp != null && scope.maisInfoEsp != ""){
	        		if(scope.isMaisInfoEsp){
		 	     
		 	             scope.insereEstatistica = function(codigosFaqCham){
		 	            	
		 	            	var isPesquisa = false;
		 	        		try {
		 	        			var identificador = new IdentificadorBB();
		 	        	    	isPesquisa = true; 
		 	        	        if(isPesquisa){
		 	        	        	//console.log("persistiuMesmo"); 
				 	            	//console.log(codigosFaqCham);
	 	    						identificador.gravaCookieCliente();
	 	    						identificador.contaObjetoExterno(1, 0,'CHMD_1', codigosFaqCham ,''); 	    					
		 	    				}			
		 	        		}catch(e){ 
		 	        		
		 	        		}
		 	        	}
	        		}
	        	} 	        	
    		});
    	}
    		
      };
    })
    
    .directive('bbRelacionados', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/relacionados.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {
        		
        	        scope.goRelacionados = function(endereco) {
						if(endereco !="" && endereco != null){
							if(endereco.trim() !=""){	    					
								fRedSiteExt.redirecionarSiteExterno(endereco);
							}else{	    					
							}	 
						}
			        };
			        scope.chamarLinkRelacionados= function(endereco) {
						if(endereco !="" && endereco != null){
							if(endereco.trim() !=""){	    					
								fRedSiteExt.redirecionarSiteExterno(endereco);
							}
						}
			        };	
        	}); 
        }
      };
    }) 
    
    .directive('bbAccordionTabela3', function($rootScope, $sce) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/accordion-tabela-3.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {
        		
				scope.trustAsHtml = function(string) {
				    return $sce.trustAsHtml(string);
				 };
		   		 setTimeout(function(){
		        		$('.tb_accordion').bind('footable_breakpoint', function() {}).footable();
		        		
		       	},100); 	        		 
        	}); 
        }
      };
    }) 

    
    .directive('bbFiltroCartoes', function($rootScope, $http, $sce) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-cartoes.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {
        		
        		
        		
        		//COMPONENTE FILTRO CARTOES    	        	
	        	scope.controleRetorno = false;
	        	scope.controleConteudo = false;
	        	
	        	scope.selecionaItem = function(el){
	        		
	        		var imagem = el.cartao.imagem.enderecoImagem;
	        		var titulo = el.cartao.titulo;		    	        		
	        		var codigo = el.cartao.noticia.codigo;
	        		
	        		var urlWsDetalhe = "/pbb/rest/WsNoticia/detalhe/"+portalParam.diretorioPai+"/"+portalParam.diretorioFilho+"/"+portalParam.tempoCache+"/21/"+codigo;
	        		scope.isNoticiaDetalheFiltro = false;
	        		
	    	    	$http.get(urlWsDetalhe).success(function(data){		    	    	    		
	    	    		if (data != ""){
	    	    			scope.noticiaDetalheFiltro = data; 
	    	    			scope.isNoticiaDetalheFiltro = true;
	    	    		}		    	    	    		
	    	    	}); 
	        		
	        		var stringRetorno = "<img src='" + imagem + "' class='imgFC' /><p style='color: #215197 !important; font-weight: normal !important;'>"+ titulo + "</p><span class='icon-arrow-down'></span>";
	        		
	        		$("#box-input").html(stringRetorno);
	        		$("#box-input").children("span").addClass("icon-arrow-down");
	    			$("#box-input").children("span").removeClass("icon-arrow-up");
	        		
	        		scope.controleRetorno = false;
	        		scope.controleConteudo = true;
	        		
	        	}
	        	
	        	scope.montaBarra = function(){
	        		$("#retornoFC").mCustomScrollbar();
	        	}
	        	
	        	scope.mudaIcone = function(){
	        		if(scope.controleRetorno){
	        			$("#box-input").children("span").addClass("icon-arrow-down");
	        			$("#box-input").children("span").removeClass("icon-arrow-up");
	        			scope.controleRetorno = false;
	        		}else{
	        			$("#box-input").children("span").removeClass("icon-arrow-down");
	        			$("#box-input").children("span").addClass("icon-arrow-up");
	        			var larguraInput = $("#box-input").width() + 18;
	        			$("#retornoFC").width(larguraInput);
	        			scope.controleRetorno = true;
	        		}
	        	}
	        	
	        	scope.trustHtmlFiltro = function(string) {
	                 return $sce.trustAsHtml(string);
	            };    	    	
        		
        		
        		
        		
        		
        	}); 
        }
      };
    })
    
    .directive('bbFiltroLocalidade', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-localidade.html',
        replace: true,
      };
    })
    
     .directive('bbFiltroData', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-data.html',
        replace: true,
        link: function(scope, element, attr) {
        	if(portalParam.idioma == 1){
        		$('.datepicker').datepicker({ dateFormat: "mm/yy",
        			 	dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],
        			    dayNamesMin: ['D','S','T','Q','Q','S','S','D'],
        			    dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb','Dom'],
        			    monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
        			    monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
        			    nextText: 'Próximo',
        			    prevText: 'Anterior'});        		
        	} else {
            	$('.datepicker').datepicker({ dateFormat: "yy/mm" });        		
        	}
        }
      };
    })
    
    .directive('bbEventos', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/eventos.html',
        replace: true
      };
    })
     
    .directive('bbSelectNecessidade', function($rootScope, $timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/necessidades/select-necessidade.html',
        replace: true,
        scope: {data:'='},
        link: function(scope, element, attr) {
        	
	    	scope.isNecessidadesTitulo = false;
	    	scope.isNecessidadesMenu = false;
	    	
         	scope.$watch('necessidades', function() {
         		
         		//TODO ver porque nao esta vindo os dados aqui
         		if(typeof scope.necessidades !== 'undefined') {
         		
	         		
	         		if(scope.necessidades.textoTituloNecessidades != null) {
	 					scope.isNecessidadesTitulo = true;
	 				}
	 				
		    		if(scope.necessidades.menu != null){
		    			scope.isNecessidadesMenu = true;
		    		}
		    		
	    			if(scope.necessidades.textoTituloNecessidades != null  && scope.necessidades.menu != null){
	    				scope.isNecessidades = true;    				
	    			}
	    			
	    			if(scope.necessidades.textoTituloNecessidades == null && scope.necessidades.menu != null){
	    				scope.isNecessidades = true;    				
	    			}
	    			
         		}
         		
         		$timeout(function(){
         		
         			scope.selectItem = function(el){
        	    			var url = el.menu.link.trim();
        	    			var nome = el.menu.nome.trim();
        	    			var input = document.getElementById("inputNecessidade");
        	    			
        	    			input.value = nome;
        	    			input.setAttribute("link", url);
        	    		 	document.getElementById('retornoSelect').style.display = "none";
        	    		}
        	    		
        	    		
        	    		scope.redirecionaNecessidade = function(){
        	    			var url = document.getElementById("inputNecessidade").getAttribute("link");
        	    			document.location.href = url;
        	    		}
        	    		
        	    		
        	    		window.onresize = function(e){
        	    			if(document.getElementById('retornoSelect')!=null){
        	    				document.getElementById('retornoSelect').style.display = "none";
        	    			}
        	    		}
        	    		
        	    		scope.getValoresPesquisa = function(isClick){
        	    			
        	    			var input = document.getElementById("inputNecessidade");
        	    			var el = document.getElementById("boxSelect");
    	    				var left = el.offsetLeft;
    	    				var width = el.offsetWidth;
    	    				left -= 32;
    	    				
    	    				
    	    				$('#retornoSelect').css("margin-left", left + "px");
    	    				$('#retornoSelect').css("width", width + "px");
        	    			
    	    				if(isClick){
        	    				
        	    				if(document.getElementById('retornoSelect').style.display == "block"){
        	    					document.getElementById('retornoSelect').style.display = "none";	
        	    				}else{
        	    					document.getElementById('retornoSelect').style.display = "block";
        	    				}
        	    				
        	    			}else{
        	    				if(input.value.length >= 3){
            	    				document.getElementById('retornoSelect').style.display = "block";
            	    			}else{
            	    				document.getElementById('retornoSelect').style.display = "none";
            	    			}
        	    			}
        	    		}

        	    		
         			
         			
         		}, 1000);
         		
         		        		
         	});
         	
         	
        	
          }
      };
    })
    .directive('bbPerfis', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/perfis.html', 
        replace: true,
        scope: {data:'='},
        link: function(scope) {
        	scope.$watch('data', function() {
        		if(typeof scope.data !== "undefined"){
        		
        			scope.chamarLinkPerfis = function(endereco) {
    	    	        if(endereco !="" && endereco != null){
    	        	        if(endereco.trim() !=""){    
    	        	        	fRedSiteExt.redirecionarSiteExterno(endereco);

    	        	        }
    	    	        }
    		        };
        		}
        	});
        } 	
        
      };
    })
    .directive('bbServicos', function($rootScope, fRedSiteExt) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/servicos.html', 
        replace: true,
        scope: {data:'='},
        link: function(scope) {
        	
        	scope.$watch('data', function() {
        		
    			if(typeof scope.data !== "undefined"){    				
    				scope.chamarLinkServicos = function(endereco) {
	        			if(endereco !="" && endereco != null){
	        				if(endereco.trim() != ""){	    					
	        					fRedSiteExt.redirecionarSiteExterno(endereco);

	        				}else{
	        			
	        				}	 
	        			}
	                };
	                
	                scope.trataTexto = function(){
	                	$(".list-services").find(".textoTratado").each(function(){
	                		var texto = $(this).text();
	    					var $container = $(this);
	    					var alturaContainer = $container.css('height');
	    					var alturaHidden = $container[0].scrollHeight - 2;
	    					alturaContainer = parseInt(alturaContainer.replace('px',''))+5;	
	    					while ( alturaHidden > alturaContainer ) {
	    						$container.text(function (index, text) {
	    				            return text.replace(/\W*\s(\S)*$/, '...');
	    				       });
	    					   alturaHidden = $container[0].scrollHeight;
	    					}
	    				}); 
	        		};
	        		
	        		
    			}
        		
        	});
        	
        }
      };
    })
    .directive('bbVideo', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/video.html', 
        replace: true,
        scope: {data:'='}
      };
    })
    .directive('bbErroBusca', function($rootScope, fBuscaGSA) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/s001/componentes/busca/erro.html',
        replace: true,
        link: function(scope, element, attr) {
        	scope.$watch('isErroBusca', function() {
        		if(scope.isErroBusca){
        			fBuscaGSA.buscarDadosComplementares("bbErroBusca").then(function(response) {
        			  	if (response.success) {
    	    		  		  scope.chamadasErro = response.dados;
        				}
    	    		});	
        		}	
        	});
        }
      };
	})
    .directive('bbBuscaPrincipal', function($rootScope, fBuscaGSA) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/s001/componentes/busca/busca-principal.html',
        replace: true,
        link: function(scope, element, attr) {
        	scope.$watch('isBuscaPrincipal', function() {
        		if(scope.isBuscaPrincipal){
        			fBuscaGSA.buscarDadosComplementares("bbBuscaPrincipal").then(function(response) {
        			  	if (response.success) {
    	    		  		  scope.buscaPrincipal = response.dados;
        				}
    	    		});	
        		}	
        	});
        }
      };
	})
    .directive('bbBuscaSemResultado', function($rootScope, fBuscaGSA) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/s001/componentes/busca/busca-sem-resultado.html',
        replace: true,
        link: function(scope, element, attr) {
        	scope.$watch('isBuscaSemResultado', function() {
        		if(scope.isBuscaSemResultado){
        			fBuscaGSA.buscarDadosComplementares("bbBuscaSemResultado").then(function(response) {
        			  	if (response.success) {
    	    		  		  scope.buscaSemResultado = response.dados;
        				}
    	    		});	
        		}	
        	});
        }
      };
	})
	.directive('bbResultadoSimples', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/s001/componentes/busca/resultado-simples.html',
        replace: true
      };
    }) 
	.directive('bbDestaqueBuscaHome', function($rootScope, $sce, $location,$portalUtil, fBuscaGSA,$q, $timeout, $fTemporizador, $customizacao) {
      return {
        restrict: 'E',
		templateUrl: '/pbb/app/sites/s001/componentes/destaque-busca-home.html?v=1',
        replace: true,
        scope: {data:'='},
        link: function (scope, element, attrs) {
        	scope.$watch('data', function() {
        		
        		if(typeof(scope.data) != "undefined"){  
        		
        			scope.inputDestaqueBuscaHome = {};
        	    	scope.inputDestaqueBuscaHome.value = "";
        	    	
        	    	scope.LABEL = {"MAIS_BUSCADOS" : $rootScope.LABEL.MAIS_BUSCADOS};
        	    	
        	    	 var $utilURL = {
        	                 endAbs: null,
        	                 getParameter : function () {
        	                 	var url = $location.absUrl();
        	     	    	    var queryStart = url.indexOf("?") + 1,
        	     	    	        queryEnd   = url.indexOf("#") + 1 || url.length + 1,
        	     	    	        query = url.slice(queryStart, queryEnd - 1),
        	     	    	        pairs = query.replace(/\+/g, " ").split("&"),
        	     	    	        parms = {}, i, n, v, nv;

        	     	    	    if (query === url || query === "") {
        	     	    	        return;
        	     	    	    }

        	     	    	    for (i = 0; i < pairs.length; i++) {
        	     	    	        nv = pairs[i].split("=");
        	     	    	        n = decodeURIComponent(nv[0]);
        	     	    	        v = decodeURIComponent(nv[1]);

        	     	    	        if (!parms.hasOwnProperty(n)) {
        	     	    	            parms[n] = [];
        	     	    	        }

        	     	    	        parms[n].push(nv.length === 2 ? v : null);
        	     	    	    }
        	     	    	    return parms;
        	     	    	},
        	                 getAbsoluta: function(){
        	                     return $location.absUrl(); 
        	                 },
        	                 getSemParam: function(){
        	                     return  $location.absUrl().substring(0,$location.absUrl().indexOf(".bb")+3);
        	                 }
        	         }
        	    	
        	    	
        	    	
     	        		
        			scope.trustAsHtml = function(string) {
 	                     return $sce.trustAsHtml(string);
 	                };
 	                
 	                var urlSemParam = $location.absUrl().split('=')[0];
 	                
 	                scope.submitDestaqueBuscaHome = function(input){
 	                	input = (typeof(input) == "undefined")? "":input;
 	                	 var urlSeg = $portalUtil.getURLBusca(portalParam.seguimento);
 	                	//lima localStorange .. recurso do botao voltar da busca
 	                	localStorage.clear();
 	                	document.location.href = urlSeg+"?search="+encodeURIComponent(input);	

    	    		};
    	    		
    	    		scope.goBanner = function(url) {
    	    			if(url.trim() != '') document.location.href = url;
    	    		}

    	    		
					
					var autoSugestions = function(){
		    	    	
			    		scope.sugestions = {};
		    	    	
		    	    	var sugestoes = [];
		    	    	
		    	    	var sugestoes_termo = function (termo) {
		    	    	    var q = termo.toLowerCase().trim();
		    	    	    var results = [];

		    	    	    for (var i = 0; i < sugestoes.length && results.length < 10; i++) {
		    	    	      var sug = sugestoes[i];
		    	    	      if (sug.toLowerCase().indexOf(q) != -1)
		    	    	        results.push({ label: sug, value: sug });
		    	    	    }
		    	    	    return results;
		    	    	}

		    	    	
		    	    	var acesso_remoto = function(term) {
						  var deferred = $q.defer();

									  $fTemporizador.cancelar($fTemporizador.acaoBuscarTermos);
									  $fTemporizador.acaoBuscarTermos = $fTemporizador.temporizarAcao(function(){
										  
										  if($portalUtil.check(term) == "")
											  return;
						    				
										 	 fBuscaGSA.buscarSugestoes(portalParam.seguimento, $portalUtil.check(term)).then(function(response) {
										 		 
								    		 	if (response.success) {
								    		 		
								    		 		if(typeof(response.dados.resultadoRelacionados.conteudo.results) != "undefined"){
								    		 			
								    		 			if(response.dados.resultadoRelacionados.conteudo.results.length > 0){
									    		 			var resultados = [];
									    		 			angular.forEach(response.dados.resultadoRelacionados.conteudo.results, 
									    		 				function(value, key) {
									    		 					
									    		 					this.push(value.name);
									    		 				}, resultados);
									    		 			sugestoes = resultados;
									    		 			deferred.resolve(sugestoes_termo(term));
									    		 		 }else{
									    		 			deferred.resolve(sugestoes_termo(term));
									    		 		 }
								    		 			
								    		 			
								    		 		}else{
								    		 			resultados = [];
								    		 			sugestoes = [];
								    		 			deferred.resolve(sugestoes_termo(term));
								    		 		}
								    		 		
								    		 		
								    			 }
											 });
											 
									  }, 100);  
										  
						  return deferred.promise;
						}

						scope.autocomplete_options = {
							 suggest: acesso_remoto
						};
						
						scope.ac_option_remote = {
						  suggest: acesso_remoto,
						  on_error: console.log
						};
			    	}
					
					autoSugestions();
					
					if(typeof $utilURL.getParameter()['search'] !== 'undefined') {
			    		var param = $utilURL.getParameter()['search'];	
			    		scope.inputDestaqueBuscaHome.value = param;
			    	}
					
        		 }
        		       		
        	});
        }

      };
    }) 
    .directive('bbFooter', function($rootScope, $timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/footer.html',
        replace: true,
        link:function(scope){
        	//id do Servidor
        	scope.ID_SERVIDOR =  portalParam.id_servidor;
        	scope.escondeMenuFooter = false;
        	scope.escondeNavEncontre = portalParam.flagFooter == "1" ? true : false;
			scope.swithMenuFooter = function(){
				scope.escondeMenuFooter = !scope.escondeMenuFooter;
				
				if(scope.escondeMenuFooter == true){
					scope.clss_escondeMenuFooter = 'sel';
				}else{
					scope.clss_escondeMenuFooter = '';
				}
				
	      	}; 
	      	
	    	scope.exibeImagem = function(endereco, tags , direcao){
				var temEndereco = false
	    		var temTag = false
	    		var resposta = false;
				if(endereco != null && endereco != ""){
	    			temEndereco =  true;
				}
	    	
				angular.forEach(tags, function(tag, key) {
	                var nomeTag  = tags[key].nomeTag;
	                
	                if(nomeTag != null && nomeTag != ""){				
						if(nomeTag == direcao){
							temTag =  true;
						}
					}
	            });

				  		
	    		if(temEndereco == true && temTag == true){
	    			resposta = true;
	    		}
	    		
	    		return resposta;				
				
	      	}; 
	      	
	      	scope.myTarget = function(linkInicial) {
	      		
	      		if(linkInicial !== null && linkInicial !== undefined) {
	      			
	      			if(linkInicial.indexOf("#ng") != -1) {
	      				return "_blank";
	      			} else {
	      				return "_self";
	      			}
	      			return "_self";
	      		}
	      		
	      	};
    		
	      	scope.$watch('footer', function() {
        		
        		if(typeof scope.footer  !== 'undefined'){
        		
        			
					if(scope.footer.menu != null && scope.footer.menu.length > 0){
						angular.forEach(scope.footer.menu, function(value, key){
							if(scope.footer.menu[key].filhos != null && scope.footer.menu[key].filhos.length > 0){
								angular.forEach(scope.footer.menu[key].filhos, function(valueF, keyF){
									
									
									if(typeof valueF.imagens[0] !== 'undefined' && typeof valueF.imagens[0].enderecoImagem !== 'undefined'){
										scope.footer.menu[key].filhos[keyF]["styleLeft"] = "{'background':'url("+valueF.imagens[0].enderecoImagem.trim()+") left no-repeat','background-size':'contain'}";
										scope.footer.menu[key].filhos[keyF]["styleRight"] = "{'background':'url("+valueF.imagens[0].enderecoImagem.trim()+") right no-repeat','background-size':'contain'}";

									}else{
										scope.footer.menu[key].filhos[keyF]["styleLeft"] = "";
										scope.footer.menu[key].filhos[keyF]["styleRight"] = "";
									}

								});
							}

						});
					}
					
        	    	 setTimeout(function(){
        		  		
        	    		 var servicecal = document.createElement('script'); 
	        	   		  servicecal.type = 'text/javascript'; 
	        	   		  servicecal.async = true; 
	        	   		  servicecal.src = window.location.protocol + '/pbb/app/docs/comum/js/componentes/global/estatisticas.js';
	        	   		  document.getElementsByTagName('head')[0].appendChild(servicecal);
        				
        		  	 },100);
        	    	 
        	    	 setTimeout(function(){
         		  		
        	    		 var servicecal = document.createElement('script'); 
	        	   		  servicecal.type = 'text/javascript'; 
	        	   		  servicecal.async = true; 
	        	   		  servicecal.src = window.location.protocol + '/pbb/app/docs/comum/js/componentes/global/ouvinteRedSiteExt.js';
	        	   		  document.getElementsByTagName('head')[0].appendChild(servicecal);
        		  	 },800);
        		}
        	});
	      	
        }
      };
    })
    .directive('bbDisclaimer', function($rootScope, $sce, $timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/disclaimer.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, element, attrs) {
        	scope.$watch('disclaimer', function() {
        		$timeout(function(){
	            	 scope.trustAsHtmlDisclamer = function(string) {
	            		 return $sce.trustAsHtml(string);
	                 };
	            },100);        		
        	});
        }

      };
    }) 
    
    .directive('bbAssembleias', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/assembleias.html',
        replace: true,
        scope: {data:'='}
      };
    })
	
    .directive('bbFiltroGloss', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-gloss.html',
        replace: true
      };
    })
    .directive('bbResultadoFiltroGloss', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/resultado-filtro-gloss.html',
        replace: true
      };
    })
     .directive('bbNavPaginas', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/nav-paginas.html',
        replace: true
      };
    })
    
    .directive('bbUltimasbb', function($rootScope) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/ultimasbb.html',
        replace: true,
        link: function (scope, el, attrs) {
        	scope.urlNoticiaAberta = '/pbb/pagina-inicial/imprensa/n/';
        	scope.slug = function(str) {
	    		if(str){
					str = str.replace(/^\s+|\s+$/g, ''); // trim
					str = str.toLowerCase();
					
					// remove accents, swap ñ for n, etc
					var from = "ãàáäâèéëêìíïîõòóöôùúüûñç·/_,:;";
					var to   = "aaaaaeeeeiiiiooooouuuunc------";
					for (var i=0, l=from.length ; i<l ; i++) {
					  str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
					}
					
					str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
						  .replace(/\s+/g, '-') // collapse whitespace and replace by -
						  .replace(/-+/g, '-'); // collapse dashes
	    		}
				return str;
    		};
        }
      };
    })
    
    
      /*
     * UltimasBBFilho diretiva
     */
    .directive('bbUltimasbbFilho', function($rootScope) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/ultimasbb.html',
        replace: true,
        link: function (scope, el, attrs) {
        	scope.urlNoticiaAberta = '/pbb/pagina-inicial/imprensa/n/';
        	scope.slug = function(str) {
	    		if(str){
					str = str.replace(/^\s+|\s+$/g, ''); // trim
					str = str.toLowerCase();
					
					// remove accents, swap ñ for n, etc
					var from = "ãàáäâèéëêìíïîõòóöôùúüûñç·/_,:;";
					var to   = "aaaaaeeeeiiiiooooouuuunc------";
					for (var i=0, l=from.length ; i<l ; i++) {
					  str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
					}
					
					str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
						  .replace(/\s+/g, '-') // collapse whitespace and replace by -
						  .replace(/-+/g, '-'); // collapse dashes
	    		}
				return str;
    		};
        }
      };
    })
    
    .directive('bbSidebarFindyoucard', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/sidebar/findyoucard.html',
        replace: true
      };
    })

    .directive('bbSidebarFaq', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/sidebar/faq.html',
        replace: true
      };
    })
    .directive('bbDestaqueProduto', function($filter, fronteira) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/destaque-produto.html',
        replace: true,
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {

        		if(typeof scope.data != null && typeof scope.data === 'object') {
	        		scope.setMain = function(index) {
	        		  	scope.data.main = scope.data[index];
	        		  	scope.data.main.video = ' ';
	        		  	$(el).find(".video").hide(0);
	        		}
	        		scope.setMain(0);

	        		scope.playVideo = function() {
	        			if(typeof scope.data.main.enderecoPaginaAnuncio !== 'string') return;
	        			if(scope.data.main.enderecoPaginaAnuncio.trim() == '') return;
	        			var codigoVideo = "";
	        			
	        			if(scope.data.main.enderecoPaginaAnuncio.indexOf("youtube") != -1){
	        				codigoVideo = $filter('youtubeID')(scope.data.main.enderecoPaginaAnuncio);
	        				scope.data.main.video = $filter('youtubeEmbed')(codigoVideo, 0, 0, 0, 1); //url:rel:controls:showinfo:autoplay
		        		  	$(el).find(".video").show(0);
	        			}else{
	        				location.href = scope.data.main.enderecoPaginaAnuncio;
	        			}
	        		  	
	        		}

	        	}
	        	
    		});
        	scope.fronteira = fronteira.calc();
        	$(window).on('resize', function(){
        		scope.fronteira = fronteira.calc();
        	});
    	}
    		
      };
    }) 
     .directive('bbDestaqueProduto2', function($filter, fronteira) {
      return {
        restrict: 'E',
        scope: {data:'='},
        templateUrl: '/pbb/app/sites/comum/componentes/destaque-produto2.html',
        replace: true,
        link: function (scope, el, attrs) {
        	scope.$watch('data', function() {
	        	if(typeof scope.data != null && typeof scope.data === 'object') {
	        		$('body').addClass('has-destaque-produto2');
	        		$("#containerMigalha").html($("#preMigalha").html());	   	
	        		
	        	}
        	});
    	}
    		
      };
    }) 

      .directive('bbBoxImgCallGrande', function($rootScope, fRedSiteExt) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/box-img-call-grande.html',
          replace: true,
          scope:{data:'='},
          link: function (scope, el, attrs) {
        	  scope.$watch('data', function() {
        	      scope.chamarLinkCGrande = function(endereco){
	    		    	if(endereco.trim() != ''){
	    		    		fRedSiteExt.redirecionarSiteExterno(endereco);
	
	    		    	}  			
	        		};			        		
		      });	  
          }
        };
      })
      
      .directive('bbGaleriaVideos', function($rootScope, $filter, $http) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/galeria-videos.html',
          replace: true,
          scope: {data:'='},
          link: function (scope, el, attrs) {
            scope.$watch('data', function() {

              if(typeof scope.data != null && typeof scope.data === 'object') {

                scope.data.listaChamada = $filter('orderBy')(scope.data.listaChamada, 'tags[0].nomeTag');
                scope.data.main = {};

                var listaCod = [];
                angular.forEach(scope.data.listaChamada, function(chamada, key) {
                  var codigoVideo = $filter('youtubeID')(scope.data.listaChamada[key].enderecoPaginaChamada);
                  this.push(codigoVideo);
                }, listaCod);

                scope.setMain = function(index) {
                  scope.data.main = scope.data.yt[index];
                  $(".gal-video-principal .overlay, .gal-video-principal img").show();
                  scope.data.main.video = ' ';
                }

                scope.playVideo = function() {
                  scope.data.main.video = $filter('youtubeEmbed')(scope.data.main.id, 0, 1, 0, 1);
                  $(".gal-video-principal .overlay, .gal-video-principal img").hide();
                }


                scope.data.yt = {};
                if(listaCod.length > 0) {
                  var strListaCod = listaCod.join(",");
                  var YTUrl = "https://www.googleapis.com/youtube/v3/videos?id="+strListaCod+"&key="+portalParam.youtubeKey+"&fields=items(id,snippet(title),snippet(description),snippet(thumbnails))&part=snippet&callback=JSON_CALLBACK";
                  $http.jsonp(YTUrl).success(function(data){
                    scope.data.yt = data.items;

                    scope.setMain(0);
                  });

                }

              }


            });
          }

        };
      })

	  .directive('bbBoxImgCallPeq', function($rootScope, $timeout, fRedSiteExt) {
	       return {
	         restrict: 'E',
	         templateUrl: '/pbb/app/sites/comum/componentes/box-img-call-peq.html',
	         replace: true,
	         scope: {data:'='},
	         link: function (scope, el, attrs) {    
	         	
            	scope.$watch('data', function() {	 
	        		//if(typeof(scope.data) != "undefined" && scope.data.length > 0) {
	        			//var data = scope.data[0];
	        		//}	        			
		       		//$timeout(function(){		       			
		       			//if(typeof(data) != "undefined") {		       			
			    		    scope.chamarLink = function(endereco){
			    		    	if(endereco.trim() != ''){
			    		    		fRedSiteExt.redirecionarSiteExterno(endereco);

			    		    	}  			
			        		};			        		
			       			//scope.data = data;			       				
		       			//} 
		       		//},1600);         	       
	          });	             
	        }	        
	      };
	  })       
	  
      .directive('addBetween', [function () {
              'use strict';
              return function (scope, element) {
                  if(!scope.$last){
                    var btw = element[0].getAttribute("add-between");
                    var tagAndClass = btw.split(".");
                    var tag = tagAndClass[0];
                    var classe = typeof tagAndClass[1] !== "undefined" ? tagAndClass[1] : "";
                      element.after('<'+tag+' class="'+classe+'"></'+tag+'>');
                  }
              }
          }
      /*
       * adiciona elementos entre as tags que se repetem em ng-repeat
       * uso: <li ng-repeat="value in dataset" add-between="tag.classe">
       */
      ])
      .directive('bbTesteiraA', function($rootScope) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/testeiraSiteA.html?nd='+Date.now(),
          replace: true
        };
      })

      .directive('bbTesteiraB', function($rootScope) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/testeiraSiteB.html?nd='+Date.now(),
          replace: true
        };
      })
      .directive('bbTesteiraC', function($rootScope) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/testeiraSiteC.html?nd='+Date.now(),
          replace: true
        };
      })

      .directive('bbBoxTextoCall', function($rootScope) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/box-texto-call.html',
          replace: true,
          scope: {data:'='},
          link: function (scope) {
            
              scope.go = function ( path ) {
                document.location.href = path;
              };
               
          }
        };
      })

      .directive('bbAgendaHome', function($rootScope) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/agenda-home.html',
          scope: {data:'='},
          replace: true
        };
      })
    
      .directive('bbTabelaGenerica', function($rootScope, $sce) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/tabela-generica.html',
          replace: true,
          scope: {data:'='},
          link: function (scope) {
        	  
        	  scope.$watch('data', function() {	 
	        		
	        		if(typeof scope.data !== "undefined"){
	        			
	        			scope.tabelaGenericaTagClass = function(tags) {
	     	    			var tagClass = "";
	     	    			for (var i = 0; i < tags.length; i++) {
	     	    				tagClass += "tag-"+tags[i].nomeTag+" ";
	     	    			};
	     	    			return tagClass;
	     	    		}
	             	  
	        		}
        	  });
		       		 
          }
        };
      })
      
		.filter('changeToBlackFont', function(){
			return function(texto){
				if(texto){
				    var textoIni = "";
				    var textoMeio = "";
				    var textoFim = "";
				    var textoTratado ="";
				    var primeiraOc = -1;
				    var segundaOc = -1;
				    var primeiraOc = texto.indexOf("$$");
				    var segundaOc = texto.lastIndexOf("$$");
				    if(primeiraOc != -1 && segundaOc != -1){
				    	textoIni = texto.substring(0,primeiraOc);
				    	primeiraOc = primeiraOc + 2;
				    	segundaOc = segundaOc;
				    	textoMeio = texto.substring(primeiraOc, segundaOc);
				    	segundaOc = segundaOc + 2;
				    	textoFim = texto.substring(segundaOc, texto.length);
				    	textoTratado = textoIni+"<strong>"+textoMeio+"</strong>"+textoFim;
				    }else{
				    	textoTratado = texto;
				    }
					return textoTratado;
				}
			};
		})
		
		.filter('unique', function() {
		
		  return function (arr, field) {
			if(arr){
			    var o = {}, i, l = arr.length, r = [];
			    for(i=0; i<l;i+=1) {
			      o[arr[i][field]] = arr[i];
			    }
			    for(i in o) {
			      r.push(o[i]);
			    }
			    return r;
			}
		  };
		})
      
	
	
	  .directive('bbTemaNuvem', function($rootScope) {
	      return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/tema-nuvem.html',
	        replace: true,
	        link: function(scope, element, attr) { 
	        	
	        	scope.escondeNuvem = false;
	
	        	scope.switchNuvem = function(){
	        		scope.escondeNuvem = !scope.escondeNuvem;
	    		}; 
	      }
	    };
	  })
	
	  .directive('bbNoticiaAberta', function($rootScope) {
	      return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/noticia-aberta.html',
	        replace: true
	      };
	    })
	
	  .directive('bbNoticiaRel', function($rootScope) {
	      return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/noticia-rel.html',
	        replace: true
	      };
	    })
	    
	    
	    .directive('bbMapadosite', function($rootScope) {
	    	return {
			    restrict: 'E',			    
			    templateUrl: '/pbb/app/sites/comum/componentes/mapaDoSite.html',		    
			    //scope: {sum:'='},	   	    
			    replace: true			    
			  };
	    })
	    
	    .directive('bbFiltroMapaChamada', function($rootScope) {
	    	return {
			    restrict: 'E',			    
			    templateUrl: '/pbb/app/sites/comum/componentes/filtro-mapa-chamada.html',
		    	replace: true			    
			  };
	    })
    
    .directive('bbTodosVideos', function($rootScope, $sce, $filter, $http) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/todos-videos.html',
        replace: true,
        scope: {data:'='},
        link: function(scope, element, attr) {
          scope.$watch('data', function() {


           if(typeof scope.data != null && typeof scope.data === 'object') {

              scope.data.main = {};

              var listaDestaque = $filter('orderBy')(scope.data.listaChamadas, 'tags[0].nomeTag');

              var listaCod = [];
           	  var listaC = {};

              angular.forEach(listaDestaque, function(chamada, key) {
              	if(listaCod.length >= 4) return true;
                var codigoVideo = $filter('youtubeID')(listaDestaque[key].enderecoPaginaChamada);
              	// if(key < 4) scope.data.videosDestaque.push(codigoVideo);
              	if(this.indexOf(codigoVideo) == -1) {
              		this.push(codigoVideo);
              		listaC[codigoVideo] = scope.data.listaChamadas[key].codigo;
	            }
              }, listaCod);
              scope.data.listac = listaC;

              // scope.data.videosDestaque = [];
              angular.forEach(scope.data.listaChamadas, function(chamada, key) {

              	if(listaCod.length >= 50) return true;
                var codigoVideo = $filter('youtubeID')(scope.data.listaChamadas[key].enderecoPaginaChamada);
              	// if(key < 4) scope.data.videosDestaque.push(codigoVideo);
              	if(this.indexOf(codigoVideo) == -1) {
              		this.push(codigoVideo);
              		listaC[codigoVideo] = scope.data.listaChamadas[key].codigo;
	              	// console.log("codigo", scope.data.listaChamadas[key].codigo, codigoVideo);
	            }
              }, listaCod);
              // console.log("listaCodYT 4", listaCodYT);


              scope.setMain = function(id, scroll) {
                scope.data.main = (typeof scope.data.ytid[id] === 'object') ? scope.data.ytid[id] : scope.data.yt[0];
                $(".section-todos-videos .video-principal .overlay, .section-todos-videos .video-principal img").show();
                scope.data.main.video = ' ';

                if (typeof scroll == 'undefined') scroll = true;

                if(scroll) {
                  if($(window).width() <= 768) {
                    $('html, body').stop().clearQueue();
                    $('html:not(:animated), body:not(:animated)').animate({
                        scrollTop: $('#principal_todosvideos').offset().top - 20
                    }, 1000);
                  }
                }

              }

              scope.playVideo = function() {
                scope.data.main.video = $filter('youtubeEmbed')(scope.data.main.id, 0, 1, 0, 1);
                $(".section-todos-videos .video-principal .overlay, .section-todos-videos .video-principal img").hide();
              }

              // console.log("listaCod", listaCod);
              if(listaCod.length > 0) {
                var strListaCod = listaCod.join(",");
                var YTUrl = "https://www.googleapis.com/youtube/v3/videos?id="+strListaCod+"&key="+portalParam.youtubeKey+"&fields=items(id,snippet(publishedAt),snippet(title),snippet(description),snippet(thumbnails))&part=snippet&callback=JSON_CALLBACK";
                $http.jsonp(YTUrl).success(function(data){
	              // console.log("YT data", data);
                  scope.data.yt = data.items;
                  scope.data.ytid = {};
                  angular.forEach(data.items, function(item, key) {
                  	this[item.id] = item;
                  }, scope.data.ytid);
                  if(typeof scope.data.yt === 'object' && scope.data.yt[0] != null) scope.setMain(0, false);
                });
              }


            }

          });

        }
      };
    })
    
    .directive('bbVideosFeed', function($rootScope, $sce, $filter, $http) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/videos-feed.html',
        replace: true,
        scope: {data:'='},
        link: function(scope, element, attr) {
          scope.$watch('data', function() {


           if(scope.data != null && typeof scope.data === 'object') {


              	// scope.data.listaChamadas = $filter('orderBy')(scope.data.listaChamadas, 'tags[0].nomeTag');
              	scope.data.main = {};

              	scope.setMain = function(index, scroll) {
              		if(typeof scope.data.yt !== 'object' || scope.data == null) {
              			$(element).hide();
              			return;
              		}
              		if(typeof scope.data.yt[index] !== 'object') {
              			$(element).hide();
              			return;
              		}
              	
                	scope.data.main = scope.data.yt[index];
                	$(".section-videos-feed .video-principal .overlay, .section-videos-feed .video-principal img").show();
                	scope.data.main.video = ' ';

                	if (typeof scroll == 'undefined') scroll = true;

                	if(scroll) {
                  	if($(window).width() <= 768) {
                    	$('html, body').stop().clearQueue();
                    	$('html:not(:animated), body:not(:animated)').animate({
                        	scrollTop: $('#principal_videosfeed').offset().top - 20
                    	}, 1000);
                  	}
                	}

              	}

              	scope.playVideo = function(showinfo) {
              		if(typeof showinfo == 'undefined') showinfo = 0;
                	scope.data.main.video = $filter('youtubeEmbed')(scope.data.main.id, 0, 1, showinfo, 1);
                	$(".section-videos-feed .video-principal .overlay, .section-videos-feed .video-principal img").hide();
              	}


              	scope.data.yt = {};
              	if(scope.data.listaCod.length > 0) {
                	var strListaCod = scope.data.listaCod.join(",");
                	var YTUrl = "https://www.googleapis.com/youtube/v3/videos?id="+strListaCod+"&key="+portalParam.youtubeKey+"&fields=items(id,snippet(title),snippet(description),snippet(thumbnails))&part=snippet&callback=JSON_CALLBACK";
                	$http.jsonp(YTUrl).success(function(data){
	                  	scope.data.yt = data.items;
	                  	// console.log('scope.data.yt', scope.data.yt);
	                  	scope.setMain(0, false);
                	});
              	}


            }

          });

        }
      };
    })
    
    .directive('bbVideoNoticia', function($rootScope, $sce, $filter, $http) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/video-noticia.html',
        replace: true,
        scope: {data:'='},
        link: function(scope, element, attr) {
          scope.$watch('data', function() {

           	if(scope.data != null && typeof scope.data === 'object') {


              	scope.data.main = {};


              	// var listaCod = [];
              	// angular.forEach(scope.data.listaChamadas, function(chamada, key) {
              	//   this.push(codigoVideo);
              	// }, listaCod);
	            // var codigoVideo = $filter('youtubeID')(scope.data[0].enderecoPaginaChamada);
	            

              scope.setMain = function(index, scroll) {
                scope.data.main = scope.data.yt[index];
                $(".section-video-noticia .video-principal .overlay, .section-video-noticia .video-principal img").show();
                scope.data.main.video = ' ';

                if (typeof scroll == 'undefined') scroll = true;

                if(scroll) {
                  if($(window).width() <= 768) {
                    $('html, body').stop().clearQueue();
                    $('html:not(:animated), body:not(:animated)').animate({
                        scrollTop: $('#principal_videonoticia').offset().top - 20
                    }, 1000);
                  }
                }

              }

              scope.playVideo = function() {
                scope.data.main.video = $filter('youtubeEmbed')(scope.data.main.id, 0, 1, 0, 1);
                $(".section-video-noticia .video-principal .overlay, .section-video-noticia .video-principal img").hide();
              }


              scope.data.yt = {};
              var codigoVideo = scope.data.listaCod[0];
            	var YTUrl = "https://www.googleapis.com/youtube/v3/videos?id="+codigoVideo+"&key="+portalParam.youtubeKey+"&fields=items(id,snippet(title),snippet(description),snippet(thumbnails))&part=snippet&callback=JSON_CALLBACK";
            	$http.jsonp(YTUrl).success(function(data){
	              	scope.data.yt = data.items;
	              	scope.setMain(0, false);
            	});


            }

          });

        }
      };
    })

    .directive('bbTabela1', function($rootScope) {
      return { 
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/tabela-1.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el) {
          scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){

       			var trs = $(scope.data[0].textoNoticia).find('tr').length;
       			var tds = $(scope.data[0].textoNoticia).find('td').length;
       			if(tds != (trs*2)) $(el).remove();

            }
          });
        }
      };
    })
    
    .directive('bbCma', function($rootScope,$timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/cma.html',
        replace: true,
        scope: {data:'='},
        link: function (scope) {
        	
        	$timeout(function() {
        		
        		/* Evento ready do Jquery para que o objeto seja criado apenas quando toda página for baixada */

                var widgets = cmaS1({

                    /* URL do aplicativo S1 hospedado na nuvem da CMA */
                    url: 'http://produtos.cma.com.br/CMA/S1/PACKAGE/SDK-EXAMPLE-RUNTIME',
                    //url: 'http://series1.cma.net',

                    /* Lista de aplicativos a serem instanciados */
                    apps: [{

                        /* ID da div que servirá de container */
                        container: 'div_instance1',

                        /* ID da página criada no projeto do CMA Workbench */
                        page: 'page0'
                    }, {

                        /* ID da div que servirá de container */
                        container: 'div_instance2',

                        /* ID da página criada no projeto do CMA Workbench */
                        page: 'page1'
                    }]
                });

                /* Método responsável pela criação dos aplicativos */
                widgets.create();
            
        	},300);
        	
        	

        	
        	
        }
      };
    })

    .directive('bbTabela3', function($rootScope, $filter) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/tabela-3.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, el) {
          scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){

       			// var trs = $(scope.data[0].textoNoticia).find('tr').length;
       			// var tds = $(scope.data[0].textoNoticia).find('td').length;
       			// if(tds != (trs*4)) $(el).css({"outline" : "1px solid red", "outline-offset" : "-1px"}); //$(el).remove();
       			// $(el).prepend("<div style='color:red'>"+$(el).attr('ng-show')+"</div>");

            }
          });
        }
      };
    })
    
     .directive('bbTabela4', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/tabela-4.html',
        replace: true,
        scope: {data:'='},
        link: function (scope) {
          scope.$watch('data', function() {
        	  
        	  	if(typeof scope.data !== 'undefined') {
        	  		scope.data['sel'] = {};

        	  		// var onlyUnique = function(value, index, self) {return self.indexOf(value) === index;};
        	  		// var listaTags = scope.data.listaTags.filter( onlyUnique );
        	  		// console.log("listaTags",listaTags);
        	  		var listaTags = [];
					angular.forEach(scope.data.listaTags, function(tag, key){
						var tituloTag = scope.data.listaTags[key].tituloTag;
						var tituloTagLower = tituloTag.toLowerCase();
						if(listaTags.indexOf(tituloTag) == -1 
						&& tituloTagLower.indexOf("tag posição") == -1
						&& tituloTagLower != "smartphone"
						&& tituloTagLower != "tablet"
						&& tituloTagLower != "desktop") { //&& tag.codigoGrupoTag != 77 = tag de controle
							listaTags.push(tituloTag);
							scope.data.sel[tituloTag] = false;
						}
		    		});
		    		scope.data.listaTags = listaTags;
					scope.data.sel['Todos'] = true;

	        	  scope.selcionaFiltroTag = function(tag){
	        		  scope.data.sel[tag] = scope.data.sel[tag] ? false : true;
	        		  if(tag == "Todos" && scope.data.sel.Todos) {
	        			  angular.forEach(scope.data.sel, function(value, key){
	        				  if(key != "Todos") {
	  						      scope.data.sel[key] = false;
	        				  }
	  		    		  });
	        		  }else{
	        			  scope.data.sel.Todos = false;
	        		  }
	  			  }
				
        	  }
        	  
          });
        }
      };
    })
    
    
    .directive('bbTabela5', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/tabela-5.html',
        replace: true,
        scope: {data:'='},
        link: function (scope) {
            scope.$watch('data', function() {
              if(typeof scope.data !== "undefined"){
                var tabela = scope.data[0].textoNoticia;
                scope.data[0].textoNoticia = angular.fromJson($('<div/>').html(tabela).text());
              }
            });
          }
      };
    })
    
    .directive('bbAssembleias2', function() {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/assembleias2.html',
        replace: true
      };
    })

    .directive('bbCalendario', function() {
      	return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/calendario.html',
	        replace: true
      	};
    })
    
    .directive('bbCalendarioAssembleias2', function($rootScope, $filter, $http, $window, $compile) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/calendario_assembleias2.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, element, attrs) {
            // attrs.$observe('ng-bind-html', function (value) {
            //     var el = $compile(value)(scope);
            //     element.empty().append(el);
            // });
          	scope.$watch('data', function() {
	            if(typeof scope.data === "object" && scope.data != null){
	            	var mergedEvents = scope.data.eventosGerais;
	            	// mergedEvents = $.merge($.merge([],scope.data.eventosRealizados), scope.data.proximosEventos);
	            	// if(typeof scope.data.eventosRealizados === 'object'
	            	// && scope.data.eventosRealizados != null 
	            	// && typeof scope.data.proximosEventos === 'object'
	            	// && scope.data.proximosEventos != null) {
		            //   	mergedEvents = $.merge($.merge([],scope.data.eventosRealizados), scope.data.proximosEventos);
	            	// }
	            	// else {
	            	// 	if(typeof scope.data.eventosRealizados === 'object' && scope.data.eventosRealizados != null) mergedEvents = scope.data.eventosRealizados;
	            	// 	else if(typeof scope.data.proximosEventos === 'object' && scope.data.proximosEventos != null) mergedEvents = scope.data.proximosEventos;
	            	// }
	            	$window.currentEvt = {'prevEvents':[],'nextEvents':[]};
	            	$window.evts = {};
		          	var calendarEvents = [];
		          	angular.forEach(mergedEvents, function(value, key){
			            var evt = {};
			            var timestart = mergedEvents[key].dataHoraInicio;
			            var today = new Date();
			            var current = today.getFullYear()+""+(("0" + (today.getMonth()+1)).slice(-2));
			            evt['id'] = mergedEvents[key].codigo;
			            evt['start'] = timestart;
			            evt['title'] = $filter('cut')(mergedEvents[key].titulo.trim(), 0, 40, '...');
			            evt['resume'] = mergedEvents[key].resumo;
			            evt['nome'] = mergedEvents[key].nome;
			            calendarEvents.push(evt);
			            // $window.evts
			            var datestart = new Date(timestart);
			            var ymstart = datestart.getFullYear()+""+(("0" + (datestart.getMonth()+1)).slice(-2));
			            if(typeof $window.evts[ymstart] === 'undefined') $window.evts[ymstart] = new Array();
			            $window.evts[ymstart].push(evt);

			            if(ymstart == current) {
			            	var dateToday = current+("0" + today.getDate()).slice(-2);
			            	var dateStart = ymstart+("0" + datestart.getDate()).slice(-2);
			            	if(dateStart < dateToday) $window.currentEvt.prevEvents.push(evt);
			            	else $window.currentEvt.nextEvents.push(evt);
			            }
		          	});
		            // console.log("$window.evts", $window.evts);

		          	// scope.data['events'] = $window.evts;

		          	

		          	var setAnoMesAtivo = function() {
		          		var calendarDate = $("#fullcalendar").fullCalendar("getDate");
		          		scope.anoMesAtivo = calendarDate.format('YYYYMM');
		          		var prevMonth = calendarDate.subtract(1, 'month').format('YYYYMM');
		          		var nextMonth = calendarDate.add(2, 'month').format('YYYYMM');

		          		// console.log("teste7", scope.anoMesAtivo, prevMonth, scope.anoMesAtivo, nextMonth);

		          		calendarDate = $("#fullcalendar").fullCalendar("getDate");
		          		var today = new Date();
		          		var current = today.getFullYear()+""+(("0" + (today.getMonth()+1)).slice(-2));
		          		var ymCalendar = calendarDate.format('YYYYMM');
		          		var prevEvents = [];
		          		var nextEvents = [];
		          		if(ymCalendar == current) {
			          		var arr = (typeof $window.evts[prevMonth] === 'object') ? $window.evts[prevMonth] : [];
			          		var arr2 = $window.currentEvt.prevEvents;
			          		prevEvents = arr.concat(arr2);
			          		arr = $window.currentEvt.nextEvents;
			          		arr2 = (typeof $window.evts[nextMonth] === 'object') ? $window.evts[nextMonth] : [];
			          		nextEvents = arr.concat(arr2);
		          		} else if(ymCalendar < current) {
			          		var arr = (typeof $window.evts[prevMonth] === 'object') ? $window.evts[prevMonth] : [];
			          		var arr2 = (typeof $window.evts[scope.anoMesAtivo] === 'object') ? $window.evts[scope.anoMesAtivo] : [];
			          		prevEvents = arr.concat(arr2);
		          		} else {
			          		var arr = (typeof $window.evts[scope.anoMesAtivo] === 'object') ? $window.evts[scope.anoMesAtivo] : [];
			          		var arr2 = (typeof $window.evts[nextMonth] === 'object') ? $window.evts[nextMonth] : [];
			          		nextEvents = arr.concat(arr2);
		          		}
		          		prevEvents = prevEvents.reverse();


		          		scope.data['prevEvents'] = prevEvents;
		          		scope.data['nextEvents'] = nextEvents;

		          		var htmlEvent = function(dia, mes, titulo, resumo) {
		          			return '<div class="container">'+
		          				'<div class="contBoxAssembleias">'+
		          					'<div class="box">'+
		          			     		'<h1>'+dia+'</h1><h3>'+mes+'</h3>'+
		          					'</div>'+
		          				'</div>'+
		          				'<div class="contDescAssembleias">'+
		          		     		'<span class="titulo">'+titulo+'</span>'+
		          		     		'<span class="texto">'+resumo+'</span>'+
		          				'</div>'+
		          			'</div>';
		          			
		          		}

		          		var tituloPrev = '';
		          		var htmlEventosPrev = '';
		          		var linkPrev = '';
		          		var tituloNext = '';
		          		var htmlEventosNext = '';
		          		var linkNext = '';
		          		var mensagem = "";

		          		if(prevEvents.length > 0) {
			          		var tituloPrev = '<h2 class="tag-proximos">'+scope.data.chamada2.titulo+'</h2>';
			          		var htmlEventosPrev = "";
			          		angular.forEach(prevEvents, function(evento, key){
			          			if(key >= 4) return true;
			          			var dia = $filter('date')(evento.start, 'dd');
			          			var mm = $filter('date')(evento.start, 'MM');
			          			var mes = $filter('mes3')(mm);
			          			var titulo = evento.title;
			          			var resumo = evento.resume;
			          			htmlEventosPrev += htmlEvent(dia, mes, titulo, resumo);
			          		});
			          	}

		          		if(nextEvents.length > 0) {
			          		var tituloNext = '<h2 class="tag-proximos">'+scope.data.chamada1.titulo+'</h2>';
			          		var htmlEventosNext = "";
			          		angular.forEach(nextEvents, function(evento, key){
			          			if(key >= 4) return true;
			          			var dia = $filter('date')(evento.start, 'dd');
			          			var mm = $filter('date')(evento.start, 'MM');
			          			var mes = $filter('mes3')(mm);
			          			var titulo = evento.title;
			          			var resumo = evento.resume;
			          			htmlEventosNext += htmlEvent(dia, mes, titulo, resumo);
			          		});
			          	}

			          	if(typeof scope.data.chamada2.enderecoPaginaChamada !== 'undefined') {
			          		if(scope.data.chamada2.enderecoPaginaChamada.trim() != '') {
			          			var textoLink = $filter('getTextoLink')(scope.data.chamada2.texto);
			          			// console.log('type textoLink', typeof textoLink, textoLink == false);
			          			if(textoLink != false && textoLink != '')
					          	linkPrev = '<a class="" href="'+scope.data.chamada2.enderecoPaginaChamada.trim()+'">'+textoLink+'</a>';
			          		}
			          	}
			          	if(typeof scope.data.chamada1.enderecoPaginaChamada !== 'undefined') {
			          		if(scope.data.chamada1.enderecoPaginaChamada.trim() != '') {
			          			var textoLink = $filter('getTextoLink')(scope.data.chamada1.texto);
			          			if(textoLink != false && textoLink != '')
				          		linkNext = '<a class="" href="'+scope.data.chamada1.enderecoPaginaChamada.trim()+'">'+textoLink+'</a>';
				          	}
			          	}

			          	if((htmlEventosPrev+htmlEventosNext) == "") {
			          		mensagem = '<h2>Nenhum evento localizado.</h2>';
			          	}

			          	// scope.data.htmlEventosRealizados = tituloPrev+htmlEventosPrev;
			          	// scope.data.htmlEventosProximos = tituloNext+htmlEventosNext;
			          	// scope.data.linkEventos = linkEvents;
			          	
			          	
			          	// if((tituloPrev+htmlEventosPrev+tituloNext+htmlEventosNext) == "") mensagem = '<h2>Nenhum evento localizado.</h2>';

				        $("#assembleias2_msg").html(mensagem);
			          	if(nextEvents.length > 0) $("#assembleias2_proximas").html(tituloNext+htmlEventosNext+linkNext).show();
				        else $("#assembleias2_proximas").html("").hide();
				        if(prevEvents.length > 0) $("#assembleias2_realizadas").html(tituloPrev+htmlEventosPrev+linkPrev).show();
				        else $("#assembleias2_realizadas").html("").hide();

		          		// console.log({
		          		// 	'tituloPrev': tituloPrev,
		          		// 	'tituloNext': tituloNext,
		          		// 	'scope': scope.data,
		          		// 	'prevEvents': prevEvents, 
		          		// 	'nextEvents': nextEvents,
		          		// 	'prevMonth': prevMonth,
		          		// 	'nextMonth': nextMonth
		          		// });

		          		// var titleAM = $("#fullcalendar").fullCalendar("getView").title;
		          		// $(".section-calendario #titulo_ano_mes").html(titleAM);

		          		// var urlGet = "http://localhost/pbb/rest/WsAssembleias2/500830/999253/0000100001/1/2/26/27/1";
		          		// $http.get(urlGet).success(function(data){		    	    	    		
		          		// 	if (typeof data === "object" && data != null){
		          		// 		console.log("data get", data);
		          		// 		angular.extend(scope.data, data);
		          		// 	}		    	    	    		
		          		// }); 

		          		// console.log('scope.anoMesAtivo', scope.anoMesAtivo);
		          		// console.log('scope', scope);
	          			// if($('.assembleias2 .proximasAssembleias .container:visible').length == 0) $('.assembleias2 .tag-proximos').hide();
	          			// else $('.assembleias2 .tag-proximos').show();
	          			// if($('.assembleias2 .assembleiasRealizadas .container:visible').length == 0) $('.assembleias2 .tag-realizados').hide();
	          			// else $('.assembleias2 .tag-realizados').show();
		          	}

		            $('#fullcalendar').fullCalendar({
		              header: { //options = 'prev,next,today,month,agendaWeek,agendaDay,title'
		                left: 'prev', 
		                center: 'title',
		                right: 'next'
		              },
		              defaultDate: new Date(),
		              lang: 'pt-br',
		              buttonIcons: {
		                prev: 'left-single-arrow',
		                next: 'right-single-arrow'
		              },
		              weekNumbers: false,
		              eventLimit: true,
		              eventLimitText: "",
		              events: calendarEvents,
		              eventAfterAllRender: function() {setAnoMesAtivo()},
					    // views: {
					    //     agenda: {
					    //         eventLimit: 6
					    //     }
					    // },
		              eventRender: function(event, element) {
		                var datetimeIni = parseInt(event.start._i);
		                var dateIni = new Date(datetimeIni);
		                var dateFormated = dateIni.toISOString().substring(0, 10);

		                $(".section-calendario .fc-day[data-date='"+dateFormated+"'], .section-calendario .fc-day-number[data-date='"+dateFormated+"']").addClass("has-event");
		                if($(".section-calendario .fc-day[data-date='"+dateFormated+"']").hasClass('fc-past')) $(element).addClass('event-past');
		                // setAnoMesAtivo();
		              }
		            });
	            }
          	});
        }
      };
    })

    .directive('bbNoticia1', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-1.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })

    .directive('bbNoticia2', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-2.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })

    .directive('bbNoticia3', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-3.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })

    .directive('bbNoticia4', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-4.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })
    
    .directive('bbNoticia5', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-5.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })
    
    .directive('bbNoticiasHome', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticiasHome.html',
        replace: true,
        //scope: {data:'='},
        link: function (scope) {
          /*scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            	scope.data.diretorioPai = portalParam.diretorioPai;
            	scope.data.diretorioFilho = portalParam.diretorioFilho;
            }
          });*/
        }
      };
    })

    .directive('bbNoticiaTema', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/noticia-tema.html',
        replace: true,
        link: function (scope) {
          
        }
      };
    })
    
	.directive('bbBbTwiter', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/bbtwitter.html',
        replace: true,
        scope: {data:'='},
        link: function (scope) {
          scope.$watch('data', function() {
            if(typeof scope.data === "object" && scope.data != null){
            }
          });
        }
      };
    })
    
    .directive('bbAcoesInterna', function($rootScope) {
    	return {
    		restrict: 'E',
    		templateUrl: '/pbb/app/sites/comum/componentes/acoes-interna.html',
	        replace: true,
	        scope: {data:'='},
	        link: function(scope, element, attr) {
	        	
	        	scope.classSetas = ["seta-esquerda", "seta-esquerda"];
            	
            	scope.abre = function(index, idAlvo){
            		if(scope.classSetas[index] == "seta-esquerda"){
            			scope.classSetas[index] = "seta-baixo";
            		}else{
            			scope.classSetas[index] = "seta-esquerda";
            		}
            		
            		if($(idAlvo).hasClass("in")){
            			$(idAlvo).removeClass("in");
            		}else{
            		   $(idAlvo).addClass("in");
            		}
            	}
	        	
	        	scope.$watch('data', function() {
	        		
		           	if(scope.data != undefined && scope.data != null && typeof scope.data === 'object') {
		           	
		           		scope.titulo1 = scope.data.titulo1;
		        		scope.titulo2 = scope.data.titulo2;
		           		
		           		scope.cotacoes = scope.data.cotacoes;
		           		scope.bolsas = scope.data.bolsas;
		           		
		           		angular.forEach(scope.data.bolsas,function(value,key){

	                		if(value.ordem == 1){
	                			scope.bolsaC = value;		
	                		}
	                	});
	                	
	                	angular.forEach(scope.data.cotacoes,function(value,key){
	                		if(value.ordem == 1){
	                			scope.cotacaoC = value;
	                		}
	                	});
	                	
	                	scope.carregarBolsa = function(bolsa){
	                		scope.bolsaC = bolsa;
	                	}
	                	
	                	scope.carregarCotacao = function(cotacao){
	                		scope.cotacaoC = cotacao;
	                	}
		           		
		           	}
	        	});
	        },
      }
    })
    
    .directive('bbFiltroResultado', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-resultado.html',
        replace: true,
      };
    })

     .directive('bbAcoesHome', function($rootScope) {
	      return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/acoesHome.html',
	        replace: true,
	        scope: {data : '=' },
	        link: function (scope) {}
	        }
	      
	})
    .directive('bbAcoesPeq', function($rootScope) {
	      return {
	        restrict: 'E',
	        templateUrl: '/pbb/app/sites/comum/componentes/acoes-peq.html',
	        replace: true
	        
	        }
	      
	  })
	 .directive('bbCambio1', function($rootScope ,$timeout) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/cambio-1.html',
        replace: true,
        scope: {data:'=', charge :'='},
        link: function(scope, element){
        		
        	scope.charged = false;
        	
        	scope.$watch('data', function() {
        		if(scope.data != undefined && scope.data != null && typeof scope.data === 'object') {
        			scope.charged = true;
        			
	           		
        			$timeout(function(){
	           			
	           			var selector = '.divBoxCambio1'
		                    , $wrapper = $(selector, element)
		                    , itens = $wrapper.find('ul.scrollerCambio1 > li')
		                    , scroll
		                    , prevButton = $wrapper.find('.cmb1-prev')
	           				, nextButton = $wrapper.find('.cmb1-next')
	           				, itemAtual = 1;
	           				
	           				

		    			  if(itens.length > 1){ 
		          		
		    				var larguraTotal = 0
		    				$(itens).each(function( index ) {
		    					  larguraTotal += $( this ).width(); 
		    				});
		    				
		    				larguraTotal = larguraTotal+100;
		    				var larguraProporcional = larguraTotal / itens.length;
		    				  
		    	              $wrapper.find('> ul.scrollerCambio1').css('width', larguraTotal+ 'px');
		    	        
		    	              scroll = new IScroll($wrapper.get(0), {
		    	                eventPassthrough: true,
		    	                scrollX: true,
		    	                scrollY: false,
		    	                momentum: false,
		    	                snap: false,
		    	                mouseWheel: true,
		    	                scrollbars: false,
		    	                snapSpeed: 600,
		    	                click: true
		    	              });
		    	              
		    	              prevButton.css("cursor: default");
		    	              nextButton.css("cursor: default");
		    	              prevButton.click(function(){
		    	            	  deslocarSlide("nada","prev");
		    	              });
		    	              
		    	              nextButton.click(function(){
		    	            	  deslocarSlide("nada","next");
		    	              });
		    	              
		    	              var deslocamentoAtual = 0;
		    	              
		    	              var destacar = function( itemAtual ){
		    	            	 for (var int = 1; int < itens.length + 1; int++) {
		    						  document.querySelector('ul.scrollerCambio1 li:nth-child('+int+')').style.background='transparent'; 
		    					 }
	    						 document.querySelector('ul.scrollerCambio1 li:nth-child('+itemAtual+')').style.background ='#eee'; 
		    	              }
		    	              var deslocarSlide = function(alvo, direcao){
			    				  
			    				  if (direcao == "prev"){
			    					  if(itemAtual > 2){
			    						 
			    					  }else{
			    						  itemAtual  = itens.length;
			    					  } 
			    					  destacar(itemAtual);
			    					  scroll.scrollToElement(document.querySelector('ul.scrollerCambio1 li:nth-child('+itemAtual+')'),400, -100);
			    					  itemAtual--;
			    				  }
			    				  
			    				  if (direcao == "next"){
			    					 if(itemAtual > itens.length-1){
				    					itemAtual = 1;		 
				    				 }
			    					 itemAtual++;
			    					 destacar(itemAtual); 
			    					 
			    					 scroll.scrollToElement(document.querySelector('ul.scrollerCambio1 li:nth-child('+itemAtual+')'),400, -100);
			    					
			    				  }
		                        	
		                        }  
		    	              
		    			  }
		    			  
		    			  
		    			  
		    			  
	           		},500);
	           		
	    			
	           		
	           	}
        	});
        	
        	
        	
        }
      }
	})   
	.directive('bbCambio2',	function($rootScope) {
		return {
			restrict : 'E',
			templateUrl : '/pbb/app/sites/comum/componentes/cambio-2.html',
			replace : true,
			scope: {data:'='},
			link: function (scope) {
					
				}
			}
	})
    .directive('bbFiltroNoticias', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/filtro-noticias.html',
        replace: true
      };
    })
     .directive('bbAvCookies', function($rootScope, $sce, $timeout, $cookieUtil) {
        return {
          restrict: 'E',
          templateUrl: '/pbb/app/sites/comum/componentes/av-cookies.html',
          replace: true,
          scope: {data:'='},
          link: function (scope, element, attrs) {
          	scope.$watch('data', function() {
          		if(scope.data != undefined && scope.data != null && typeof scope.data === 'object') {
          			var jsonMetaInf = {};
              		
          			var  hexToRgb = function(hex)  {
          			    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
          			    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
          			    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
          			        return r + r + g + g + b + b;
          			    });

          			    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
          			    return result ? {
          			        r: parseInt(result[1], 16),
          			        g: parseInt(result[2], 16),
          			        b: parseInt(result[3], 16)
          			    } : null;
          			}

              			
              			if(scope.data[0].resumo != null){
              				
              				scope.data[0].estiloPersonal = {}
              				jsonMetaInf = angular.fromJson(scope.data[0].resumo);
              				scope.data[0].estiloPersonal.opacity = "0.8";
              				scope.data[0].estiloPersonal.corFundo = "#000";
              	
              				if(jsonMetaInf.corBackground != "" && jsonMetaInf.transparencia != ""){
              					var corRGB =  hexToRgb(jsonMetaInf.corBackground);
              					scope.data[0].estiloPersonal.corFundo = "rgba("+corRGB.r+","+corRGB.g+","+corRGB.b+","+(jsonMetaInf.transparencia / 100)+");" ;
              				}


              			}
      	            	 
              			scope.ok = function() {
              				var validade = 7;
              				if(typeof jsonMetaInf.validade !== "undefined"){
              					validade = jsonMetaInf.validade;
              					if(validade == 0){
              						validade = 360;
              					}
              				}
              				$cookieUtil.put('pbb.politica','vs=true', validade);
              				$rootScope.isAvCookies = false;
      	                 };
      	                 
      	               scope.trustHtmlH = function(text) {
             				return $sce.trustAsHtml(text);
     	               };
          		}
          		
          		  		
          	});
          }

        };
      }) 
     .directive('bbRedSiteExt', function($rootScope) {
      return {
        restrict: 'E',
        templateUrl: '/pbb/app/sites/comum/componentes/red-site-ext.html',
        replace: true,
        scope: {data:'='},
        link: function (scope, element, attrs) {
        	
        	scope.abrirLink = function(){
        		var urlDestino = localStorage.getItem("urlDestino");
        		window.open(urlDestino, "_self");
    	    }
        }
      };
    })
     .directive('bbFormularioPadrao', function($rootScope, $http) {
        return {
            restrict: 'E',
            templateUrl: '/pbb/app/sites/comum/componentes/formulario-padrao.html',
            replace: true,
            scope: {data:'='},
            link: function (scope) {
            	
            	scope.$watch('data', function() {
            		
            		if(typeof scope.data !== 'undefined' && scope.data != "" && scope.data.length > 0) {
            			            			
            			scope.LABEL = $rootScope.LABEL;
            			
            			var buscarCampoPorLocalizacao = function buscarLocalizacaoCampo(array, loc, remove){
        				    for (var i=0; i < array.length; i++) {
        				        if (array[i].localizacao == loc) {
        				            var obj = array[i];
        				            if(remove) {
        				            	array.splice(i,1);
        				            }
        				            return obj;
        				        }
        				    }
        				};
        				
        				scope.form = {};
        				scope.botaoLoc101 =	buscarCampoPorLocalizacao(scope.data,101, true);
        				scope.botaoLoc102 = buscarCampoPorLocalizacao(scope.data,102, true);
        				scope.tipoPessoa = "1";
        				scope.confirmarDesabilitado = false;
        				
        				 for (var i=0; i < scope.data.length; i++) {
							
            				if(scope.data[i].rotuloCampo.indexOf('*') != -1) {
            					scope.data[i].rotuloCampo = scope.data[i].rotuloCampo.replace("*","<span class='asterisco'>*</span>");
            				}
						}        				        				        			
        				scope.mudaTipoPessoa = function(valor) {
        					scope.tipoPessoa = valor;
        					if(valor == "1") {        						
        						$("#campoCPF-CNPJ").val("");
        						$("#campoCPF-CNPJ").mask('000.000.000-00');
        					}
        					if(valor == "2") {
        						$("#campoCPF-CNPJ").val("");
        						$("#campoCPF-CNPJ").mask('00.000.000/0000-00');
        					}        					
        				};	
        				scope.$watch('templateCarregado',function() {
        					if(scope.templateCarregado) {
        						$("#campoCPF").mask('000.000.000-00');        						
        						$("#campoCNPJ").mask('00.000.000/0000-00');
        						$("#campoTelefone").mask("(00) 00000-0000");
        						$("#campoData").mask("00/00/0000");
        						$("#campoCPF-CNPJ").mask('000.000.000-00');
        					}
        				});
        				scope.getClass = function(classLargura) {
        					if(classLargura == "LarguraTotal") {
        						return "LarguraTotal";
        					}
        					else {
        						return "largura50";
        					}
        				}
        				
    					scope.enviarFormulario = function() {    						
    						
    						var formEnvio = {}
    						for (var i in scope.form) {
    							formEnvio["campo"+i] = scope.form[i];
    							formEnvio["rotuloCampo"+i] = buscarCampoPorLocalizacao(scope.data, i).rotuloCampo;
    							formEnvio["tipoCampo"+i] = buscarCampoPorLocalizacao(scope.data, i).tipoCampo;
    							if(buscarCampoPorLocalizacao(scope.data, i).tipoCampo == "E-mail") {
    								formEnvio["emailFrom"] = scope.form[i]; 
    							}
    						}
    						var camposPreenchidos = true;
    						$('.formPadrao').find("input[type=text], textarea").each(
       								function( index ) {    									  
   										  if(isBlank($(this).val())){
   											         										
   											  var obrigatorio = false;
   											  if($(this).attr("id") == "campoCPF-CNPJ") {
   												  
   												var textoCampo = $(this).parent().parent().find("label").first().text();
   												if(textoCampo.indexOf('*') != -1) {
   													obrigatorio = true;
   												}
   											  } 
   											  else {
   												  
   												var textoCampo = $(this).parent().parent().find("label").text();
   												if(textoCampo.indexOf('*') != -1) {
   													obrigatorio = true;
   												}
   											  }
   											  if (obrigatorio) {
   												  alert($rootScope.LABEL.FORM_PADRAO_CAMPO_N_PREEN+": "+textoCampo.replace("*",""));
     											  camposPreenchidos = false;
     											  return false;  
   											  }
   											  
   										  }    									  
       						});    						    					
    						
    						if(camposPreenchidos) {
    							scope.confirmarDesabilitado = true;
    							$http.post( "/pbb/rest/WsFormularioPadrao/"+portalParam.diretorioPai+"/"+portalParam.diretorioFilho+"/"+portalParam.seguimentoFiltro+"/"+portalParam.idioma+"/"+portalParam.tempoCache+"/94,95,96,97,98,99,100,101,102", formEnvio).then(function(data){
    								scope.confirmarDesabilitado = false;
    								scope.form = {};
        							alert($rootScope.LABEL.FORM_PADRAO_EMAIL_ENV);        							
        						},
        						function(data){
        							scope.confirmarDesabilitado = false;
    								scope.form = {};
        							alert($rootScope.LABEL.FORM_PADRAO_EMAIL_ENV_ERROR);        							
        						});
    						}
    						
            			}
            			scope.limparFormulario = function() {            				
            				$('.formPadrao').find("input[type=text], textarea").val("");
            			}
            			        				        			
            			scope.acaoBotao = function(tipoBotao) {
            				if(tipoBotao == 'Enviar') {
            					scope.enviarFormulario();
            				}
            				else if(tipoBotao == 'Limpar') {
            					scope.limparFormulario();
            				}
            			}
            			
            			scope.existeCpfCnpj = function() {
            				var existe = false;
            				 for (var i=0; i < scope.data.length; i++) {
     							
                 				if(scope.data[i].tipoCampo == "CPF-CNPJ") {
                 					existe = true;
                 				}
     						}
            				 return existe;
            			}
	           		}
        		}
        	);
            	            	
            }
          };
        })
	
});
